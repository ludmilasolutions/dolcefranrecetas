<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç∞ Pasteler√≠a Dolcefran - Sistema de Gesti√≥n</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç∞</text></svg>">
    <style>
        /* ===== VARIABLES Y RESET ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        :root {
            /* Paleta rosa pastel - Dolcefran */
            --rosa-principal: #FF66B2;
            --rosa-claro: #FF99CC;
            --rosa-suave: #FFCCE0;
            --rosa-fondo: #FFF0F5;
            --rosa-oscuro: #FF3385;
            --lila: #DDA0DD;
            --lila-claro: #E6E6FA;
            --crema: #FFF5EE;
            --dorado: #FFD700;
            --verde-menta: #98FB98;
            --verde-menta-oscuro: #7CFC00;
            --gris-claro: #f8f9fa;
            --gris: #6c757d;
            --gris-oscuro: #343a40;
            --blanco: #ffffff;
            --negro: #212529;
            --sombra: 0 8px 30px rgba(255, 102, 178, 0.12);
            --sombra-intensa: 0 15px 40px rgba(255, 102, 178, 0.2);
            --transicion: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            background: linear-gradient(135deg, var(--rosa-fondo) 0%, var(--lila-claro) 100%);
            color: var(--negro);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* ===== TIPOGRAF√çA ===== */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap');
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            color: var(--rosa-oscuro);
        }
        
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        
        /* ===== LOGIN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--rosa-fondo) 0%, var(--lila-claro) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--rosa-claro) 0%, transparent 70%);
            opacity: 0.3;
        }
        
        .login-card {
            background: var(--blanco);
            border-radius: 24px;
            box-shadow: var(--sombra-intensa);
            width: 100%;
            max-width: 450px;
            padding: 50px 40px;
            position: relative;
            z-index: 1;
            border: 2px solid var(--rosa-suave);
            overflow: hidden;
        }
        
        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--rosa-principal), var(--lila));
        }
        
        .login-logo {
            font-size: 72px;
            margin-bottom: 25px;
            text-align: center;
            color: var(--rosa-principal);
            filter: drop-shadow(0 6px 8px rgba(255, 102, 178, 0.3));
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .login-title {
            font-size: 42px;
            margin-bottom: 15px;
            text-align: center;
            color: var(--rosa-oscuro);
            font-family: 'Dancing Script', cursive;
            font-weight: 700;
        }
        
        .login-subtitle {
            color: var(--gris);
            margin-bottom: 40px;
            text-align: center;
            line-height: 1.6;
            font-size: 16px;
        }
        
        /* ===== FORMULARIOS ===== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--rosa-oscuro);
            font-size: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--rosa-suave);
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transicion);
            background: var(--blanco);
            color: var(--negro);
        }
        
        .form-control:focus {
            border-color: var(--rosa-principal);
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 102, 178, 0.15);
            transform: translateY(-2px);
        }
        
        .form-control::placeholder {
            color: var(--gris);
            opacity: 0.6;
        }
        
        /* ===== BOTONES ===== */
        .btn {
            padding: 16px 28px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transicion);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(40, 40);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--rosa-principal), var(--rosa-oscuro));
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(255, 102, 178, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 102, 178, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--verde-menta-oscuro), var(--verde-menta));
            color: var(--negro);
            box-shadow: 0 4px 15px rgba(152, 251, 152, 0.3);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FFB74D, #FF9800);
            color: var(--negro);
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .btn-sm {
            padding: 10px 18px;
            font-size: 14px;
            border-radius: 10px;
        }
        
        /* ===== ALERTAS ===== */
        .alert {
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            border: 2px solid;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-color: #b1dfbb;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-color: #f1b0b7;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-color: #ffdf7e;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border-color: #abdde5;
        }
        
        .alert-rosa {
            background: linear-gradient(135deg, var(--rosa-suave), var(--rosa-claro));
            color: var(--rosa-oscuro);
            border-color: var(--rosa-principal);
        }
        
        /* ===== APP PRINCIPAL ===== */
        #appScreen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
        }
        
        /* Header de la app */
        .app-header {
            background: linear-gradient(135deg, var(--rosa-principal), var(--rosa-oscuro));
            color: var(--blanco);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--sombra);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .app-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--dorado), transparent);
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo h1 {
            font-size: 26px;
            color: var(--blanco);
            font-family: 'Dancing Script', cursive;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--lila), var(--rosa-claro));
            color: var(--blanco);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            border: 3px solid var(--blanco);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Navegaci√≥n */
        .app-nav {
            background: var(--blanco);
            display: flex;
            overflow-x: auto;
            padding: 0 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            position: sticky;
            top: 88px;
            z-index: 999;
            border-bottom: 2px solid var(--rosa-suave);
        }
        
        .app-nav::-webkit-scrollbar {
            height: 6px;
        }
        
        .app-nav::-webkit-scrollbar-track {
            background: var(--rosa-suave);
            border-radius: 3px;
        }
        
        .app-nav::-webkit-scrollbar-thumb {
            background: var(--rosa-principal);
            border-radius: 3px;
        }
        
        .nav-item {
            padding: 20px 25px;
            white-space: nowrap;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: var(--transicion);
            font-weight: 500;
            color: var(--gris);
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
        }
        
        .nav-item:hover {
            background: var(--rosa-suave);
            color: var(--rosa-oscuro);
        }
        
        .nav-item.active {
            color: var(--rosa-oscuro);
            border-bottom-color: var(--rosa-principal);
            background: linear-gradient(to bottom, var(--rosa-suave), transparent);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--rosa-principal), var(--lila));
        }
        
        /* Contenido principal */
        .app-content {
            flex: 1;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Tarjetas */
        .card {
            background: var(--blanco);
            border-radius: 20px;
            box-shadow: var(--sombra);
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--rosa-suave);
            transition: var(--transicion);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--sombra-intensa);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--rosa-suave);
        }
        
        .card-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--rosa-oscuro);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--rosa-suave), var(--lila-claro));
            border-radius: 18px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 2px solid var(--rosa-claro);
            transition: var(--transicion);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 102, 178, 0.15);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: var(--blanco);
            background: linear-gradient(135deg, var(--rosa-principal), var(--lila));
            box-shadow: 0 6px 15px rgba(255, 102, 178, 0.3);
        }
        
        .stat-content h3 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--rosa-oscuro);
        }
        
        .stat-content p {
            color: var(--gris);
            font-size: 15px;
        }
        
        /* Tablas */
        .table-container {
            overflow-x: auto;
            border-radius: 16px;
            border: 2px solid var(--rosa-suave);
            margin-top: 20px;
        }
        
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            background: linear-gradient(135deg, var(--rosa-suave), var(--lila-claro));
            color: var(--rosa-oscuro);
            text-align: left;
            padding: 20px;
            font-weight: 600;
            border-bottom: 3px solid var(--rosa-claro);
            position: sticky;
            top: 0;
        }
        
        .table td {
            padding: 20px;
            border-bottom: 1px solid var(--rosa-suave);
            transition: var(--transicion);
        }
        
        .table tr:hover td {
            background: var(--rosa-suave);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: linear-gradient(135deg, var(--verde-menta), var(--verde-menta-oscuro));
            color: var(--negro);
        }
        
        .badge-warning {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: var(--negro);
        }
        
        .badge-danger {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: var(--blanco);
        }
        
        .badge-rosa {
            background: linear-gradient(135deg, var(--rosa-claro), var(--rosa-principal));
            color: var(--blanco);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--blanco);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
            border: 3px solid var(--rosa-claro);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 30px;
            border-bottom: 3px solid var(--rosa-suave);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--rosa-suave), transparent);
        }
        
        .modal-title {
            font-size: 26px;
            font-weight: 600;
            color: var(--rosa-oscuro);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--rosa-principal);
            transition: var(--transicion);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: var(--rosa-suave);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 25px 30px;
            border-top: 3px solid var(--rosa-suave);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            background: linear-gradient(135deg, transparent, var(--rosa-suave));
        }
        
        /* Stock bajo */
        .low-stock {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7) !important;
            border-left: 4px solid #ff9800;
        }
        
        .low-stock:hover td {
            background: #ffecb5 !important;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--gris);
            font-size: 18px;
        }
        
        .loading::after {
            content: "";
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid var(--rosa-suave);
            border-top: 3px solid var(--rosa-principal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .login-card {
                padding: 30px 25px;
            }
            
            .app-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .app-nav {
                top: 138px;
                padding: 0 15px;
            }
            
            .nav-item {
                padding: 18px 20px;
                font-size: 14px;
            }
            
            .app-content {
                padding: 20px;
            }
            
            .card {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .login-title {
                font-size: 36px;
            }
        }
        
        /* Utilidades */
        .d-none {
            display: none !important;
        }
        
        .d-flex {
            display: flex !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mt-3 {
            margin-top: 15px;
        }
        
        .mb-3 {
            margin-bottom: 15px;
        }
        
        .p-3 {
            padding: 15px;
        }
        
        /* Animaciones adicionales */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--rosa-suave);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--rosa-principal), var(--lila));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--rosa-oscuro), var(--rosa-principal));
        }
        
        /* Bot√≥n flotante para PWA */
        #installButton {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--rosa-principal), var(--lila));
            color: var(--blanco);
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            font-size: 28px;
            box-shadow: 0 8px 25px rgba(255, 102, 178, 0.4);
            cursor: pointer;
            display: none;
            transition: var(--transicion);
            animation: pulse 2s infinite;
        }
        
        #installButton:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 35px rgba(255, 102, 178, 0.6);
        }
        
        /* Decoraciones */
        .cupcake-decoration {
            position: fixed;
            font-size: 24px;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }
        
        /* Grid de cupcakes para fondo */
        .cupcakes-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 20px;
            padding: 20px;
            opacity: 0.03;
            z-index: -1;
            pointer-events: none;
        }
        
        .cupcake-item {
            font-size: 40px;
            text-align: center;
            animation: floatCupcake 20s linear infinite;
        }
        
        @keyframes floatCupcake {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            100% {
                transform: translateY(-1000px) rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- Fondo decorativo de cupcakes -->
    <div class="cupcakes-grid" id="cupcakesGrid"></div>
    
    <!-- Bot√≥n para instalar como PWA -->
    <button id="installButton" title="Instalar aplicaci√≥n">üì±</button>
    
    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">üç∞</div>
            <h1 class="login-title font-dancing">Pasteler√≠a Dolcefran</h1>
            <p class="login-subtitle">Sistema de gesti√≥n integral para tu pasteler√≠a</p>
            
            <div id="loginAlert" class="alert alert-danger d-none"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-control" placeholder="Correo electr√≥nico" required 
                           value="admin@dolcefran.com">
                </div>
                
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="Contrase√±a" required
                           value="admin123">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary pulse">üîë Iniciar Sesi√≥n</button>
                </div>
            </form>
            
            <div class="text-center mt-3">
                <p><small>Credenciales por defecto: admin@dolcefran.com / admin123</small></p>
                <p><small>üíñ Sistema conectado a Firebase</small></p>
            </div>
        </div>
    </div>
    
    <!-- Pantalla 3: Aplicaci√≥n principal -->
    <div id="appScreen">
        <!-- Header -->
        <div class="app-header">
            <div class="app-logo">
                <div style="font-size: 32px;">üç∞</div>
                <h1 class="font-dancing">Pasteler√≠a Dolcefran</h1>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userInitial">D</div>
                <div>
                    <div id="userName" style="font-weight: 500;">admin@dolcefran.com</div>
                    <button id="logoutBtn" class="btn btn-danger btn-sm">üö™ Salir</button>
                </div>
            </div>
        </div>
        
        <!-- Navegaci√≥n -->
        <div class="app-nav">
            <div class="nav-item active" data-section="dashboard">
                üìä Dashboard
            </div>
            <div class="nav-item" data-section="ingredients">
                üì¶ Insumos
            </div>
            <div class="nav-item" data-section="recipes">
                üìí Recetas
            </div>
            <div class="nav-item" data-section="production">
                üè≠ Producci√≥n
            </div>
            <div class="nav-item" data-section="shopping">
                üõí Compras
            </div>
            <div class="nav-item" data-section="movements">
                üìú Movimientos
            </div>
        </div>
        
        <!-- Contenido principal -->
        <div class="app-content">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìä</span> Dashboard - Resumen General
                        </h2>
                        <button id="refreshDashboard" class="btn btn-primary btn-sm">
                            üîÑ Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-content">
                                <h3 id="totalIngredients">0</h3>
                                <p>Insumos Registrados</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <div class="stat-content">
                                <h3 id="lowStockCount">0</h3>
                                <p>Insumos con Stock Bajo</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üìí</div>
                            <div class="stat-content">
                                <h3 id="totalRecipes">0</h3>
                                <p>Recetas Registradas</p>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon">üè≠</div>
                            <div class="stat-content">
                                <h3 id="totalProductions">0</h3>
                                <p>Producciones Hoy</p>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="mb-3" style="color: var(--rosa-oscuro);">‚ö†Ô∏è Insumos con Stock Bajo</h3>
                    <div class="table-container">
                        <table class="table" id="lowStockTable">
                            <thead>
                                <tr>
                                    <th>Insumo</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Insumos -->
            <section id="ingredients" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üì¶</span> Gesti√≥n de Insumos
                        </h2>
                        <button id="addIngredientBtn" class="btn btn-primary">
                            ‚ûï Nuevo Insumo
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Unidad</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Costo Unitario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ingredientsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Recetas -->
            <section id="recipes" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìí</span> Gesti√≥n de Recetas
                        </h2>
                        <button id="addRecipeBtn" class="btn btn-primary">
                            ‚ûï Nueva Receta
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripci√≥n</th>
                                    <th>Porciones</th>
                                    <th>Costo Total</th>
                                    <th>Costo por Porci√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="recipesList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Producci√≥n -->
            <section id="production" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üè≠</span> Registro de Producci√≥n
                        </h2>
                        <button id="registerProductionBtn" class="btn btn-primary">
                            üè≠ Registrar Producci√≥n
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Receta</th>
                                    <th>Cantidad</th>
                                    <th>Costo Total</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productionsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Compras -->
            <section id="shopping" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üõí</span> Lista de Compras
                        </h2>
                        <button id="refreshShoppingList" class="btn btn-primary btn-sm">
                            üîÑ Actualizar
                        </button>
                    </div>
                    
                    <div class="alert alert-rosa">
                        <strong>üéÄ Lista autom√°tica:</strong> Se generan los insumos que tienen stock por debajo del m√≠nimo.
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Insumo</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Cantidad a Comprar</th>
                                    <th>Costo Estimado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="shoppingList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Movimientos -->
            <section id="movements" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìú</span> Movimientos de Stock
                        </h2>
                        <div>
                            <select id="movementFilter" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;">
                                <option value="all">Todos los movimientos</option>
                                <option value="ingreso">Ingresos</option>
                                <option value="egreso">Egresos</option>
                            </select>
                            <button id="refreshMovements" class="btn btn-primary btn-sm">
                                üîÑ Actualizar
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Insumo</th>
                                    <th>Tipo</th>
                                    <th>Cantidad</th>
                                    <th>Motivo</th>
                                </tr>
                            </thead>
                            <tbody id="movementsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal para Insumos -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="ingredientModalTitle">
                    <span>üì¶</span> Nuevo Insumo
                </h3>
                <button class="modal-close" data-modal="ingredientModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ingredientForm">
                    <input type="hidden" id="ingredientId">
                    
                    <div class="form-group">
                        <label class="form-label" for="ingredientName">Nombre del Insumo *</label>
                        <input type="text" id="ingredientName" class="form-control" placeholder="Ej: Harina de Trigo" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label" for="ingredientUnit">Unidad de Medida *</label>
                            <select id="ingredientUnit" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="g">Gramos (g)</option>
                                <option value="kg">Kilogramos (kg)</option>
                                <option value="ml">Mililitros (ml)</option>
                                <option value="l">Litros (l)</option>
                                <option value="u">Unidades (u)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="ingredientCostUnit">Unidad de Costo *</label>
                            <select id="ingredientCostUnit" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="g">Por gramo</option>
                                <option value="kg">Por kilogramo</option>
                                <option value="ml">Por mililitro</option>
                                <option value="l">Por litro</option>
                                <option value="u">Por unidad</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label" for="currentStock">Stock Actual *</label>
                            <input type="number" id="currentStock" class="form-control" step="0.01" placeholder="0.00" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="minStock">Stock M√≠nimo *</label>
                            <input type="number" id="minStock" class="form-control" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="unitCost">Costo Unitario ($) *</label>
                        <input type="number" id="unitCost" class="form-control" step="0.01" min="0" placeholder="0.00" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="ingredientModal">Cancelar</button>
                <button id="saveIngredientBtn" class="btn btn-primary">üíæ Guardar Insumo</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Recetas -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="recipeModalTitle">
                    <span>üìí</span> Nueva Receta
                </h3>
                <button class="modal-close" data-modal="recipeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="recipeForm">
                    <input type="hidden" id="recipeId">
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeName">Nombre de la Receta *</label>
                        <input type="text" id="recipeName" class="form-control" placeholder="Ej: Pastel de Chocolate Premium" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeDescription">Descripci√≥n</label>
                        <textarea id="recipeDescription" class="form-control" rows="3" placeholder="Describe la receta..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="recipePortions">N√∫mero de Porciones *</label>
                        <input type="number" id="recipePortions" class="form-control" min="1" placeholder="8" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üéÄ Ingredientes</label>
                        <div id="recipeIngredientsContainer">
                            <!-- Ingredientes se a√±adir√°n din√°micamente -->
                        </div>
                        <button type="button" id="addIngredientToRecipe" class="btn btn-rosa btn-sm mt-2">
                            ‚ûï A√±adir Ingrediente
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeInstructions">Instrucciones</label>
                        <textarea id="recipeInstructions" class="form-control" rows="4" placeholder="1. Mezclar los ingredientes secos..."></textarea>
                    </div>
                    
                    <div class="alert alert-rosa">
                        <strong>üíñ Nota:</strong> El costo total y por porci√≥n se calcular√°n autom√°ticamente al guardar.
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="recipeModal">Cancelar</button>
                <button id="saveRecipeBtn" class="btn btn-primary">üíæ Guardar Receta</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Producci√≥n -->
    <div id="productionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>üè≠</span> Registrar Producci√≥n
                </h3>
                <button class="modal-close" data-modal="productionModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productionForm">
                    <div class="form-group">
                        <label class="form-label" for="productionRecipe">Receta *</label>
                        <select id="productionRecipe" class="form-control" required>
                            <option value="">Seleccionar receta</option>
                            <!-- Opciones cargadas din√°micamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productionQuantity">Cantidad Producida *</label>
                        <input type="number" id="productionQuantity" class="form-control" min="1" placeholder="1" required>
                        <small style="color: var(--gris);">N√∫mero de unidades/batches producidos</small>
                    </div>
                    
                    <div id="productionInfo" class="alert alert-info d-none">
                        <!-- Informaci√≥n de la receta seleccionada -->
                    </div>
                    
                    <div id="productionValidation" class="alert alert-warning d-none">
                        <!-- Validaci√≥n de stock -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="productionModal">Cancelar</button>
                <button id="saveProductionBtn" class="btn btn-primary">üè≠ Registrar Producci√≥n</button>
            </div>
        </div>
    </div>
    
    <!-- Script principal -->
    <script>
        // ===== CONFIGURACI√ìN DE FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyCn-IxmpSh1PNg81zDCd8GUC7imM9XXAVA",
            authDomain: "dolcefranrecetas.firebaseapp.com",
            projectId: "dolcefranrecetas",
            storageBucket: "dolcefranrecetas.firebasestorage.app",
            messagingSenderId: "322101534324",
            appId: "1:322101534324:web:e95dee5189edd3309ffb21"
        };
        
        // ===== VARIABLES GLOBALES =====
        let db = null;
        let auth = null;
        let currentUser = null;
        let isSystemConfigured = false;
        let deferredPrompt = null;
        
        // Estado de la aplicaci√≥n
        const appState = {
            ingredients: [],
            recipes: [],
            productions: [],
            shoppingList: [],
            movements: []
        };
        
        // ===== ELEMENTOS DOM =====
        const loginScreen = document.getElementById('loginScreen');
        const appScreen = document.getElementById('appScreen');
        const loginForm = document.getElementById('loginForm');
        const loginAlert = document.getElementById('loginAlert');
        const installButton = document.getElementById('installButton');
        
        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', () => {
            // Crear fondo decorativo de cupcakes
            createCupcakeBackground();
            
            // Inicializar Firebase
            initializeFirebase();
            
            // Inicializar eventos
            initializeEventListeners();
        });
        
        // ===== FUNCIONES DE INICIALIZACI√ìN =====
        function createCupcakeBackground() {
            const grid = document.getElementById('cupcakesGrid');
            const cupcakes = ['üç∞', 'üßÅ', 'üéÇ', 'üçÆ', 'üç©', 'üç™', 'ü•ê', 'ü•®', 'ü•û', 'üç´', 'üç¨', 'üç≠'];
            
            for (let i = 0; i < 50; i++) {
                const cupcake = document.createElement('div');
                cupcake.className = 'cupcake-item';
                cupcake.textContent = cupcakes[Math.floor(Math.random() * cupcakes.length)];
                cupcake.style.animationDelay = `${Math.random() * 20}s`;
                cupcake.style.fontSize = `${Math.random() * 30 + 20}px`;
                cupcake.style.opacity = Math.random() * 0.05 + 0.02;
                grid.appendChild(cupcake);
            }
        }
        
        function initializeEventListeners() {
            // Login
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await handleLogin(email, password);
            });
            
            // App principal
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                auth.signOut();
                showLoginScreen();
            });
            
            // Navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    // Remover clase active de todos
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(section => section.classList.add('d-none'));
                    
                    // Activar el seleccionado
                    item.classList.add('active');
                    const sectionId = item.getAttribute('data-section');
                    document.getElementById(sectionId).classList.remove('d-none');
                    
                    // Cargar datos espec√≠ficos de la secci√≥n
                    loadSectionData(sectionId);
                });
            });
            
            // PWA
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installButton.style.display = 'block';
            });
            
            installButton.addEventListener('click', async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installButton.style.display = 'none';
                }
                deferredPrompt = null;
            });
            
            window.addEventListener('appinstalled', () => {
                installButton.style.display = 'none';
            });
        }
        
        // ===== MANEJO DE PANTALLAS =====
        function showLoginScreen() {
            loginScreen.classList.remove('d-none');
            appScreen.style.display = 'none';
            hideLoginAlert();
        }
        
        function showAppScreen() {
            loginScreen.classList.add('d-none');
            appScreen.style.display = 'flex';
        }
        
        // ===== CONFIGURACI√ìN DE FIREBASE =====
        async function initializeFirebase() {
            try {
                // Si ya hay una app, eliminarla primero
                if (firebase.apps.length > 0) {
                    await firebase.app().delete();
                }
                
                // Inicializar Firebase con las credenciales fijas
                firebase.initializeApp(firebaseConfig);
                
                // Inicializar servicios
                db = firebase.firestore();
                auth = firebase.auth();
                
                // Configurar Firestore
                db.settings({
                    ignoreUndefinedProperties: true
                });
                
                // Configurar listener de autenticaci√≥n
                auth.onAuthStateChanged(handleAuthStateChange);
                
                // Verificar si el sistema est√° configurado
                isSystemConfigured = await checkSystemConfiguration();
                
                if (!isSystemConfigured) {
                    showLoginAlert('‚ö†Ô∏è Sistema no configurado', 'warning');
                    showLoginAlert('El sistema no est√° configurado. Ejecuta setup.html en una PC para configurar la base de datos.', 'warning');
                }
                
                return true;
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                showLoginAlert('‚ùå Error de conexi√≥n a Firebase: ' + error.message, 'danger');
                return false;
            }
        }
        
        async function checkSystemConfiguration() {
            try {
                const configDoc = await db.collection('systemConfig').doc('setup').get();
                return configDoc.exists && configDoc.data().setupCompleted;
            } catch (error) {
                console.error('Error verificando configuraci√≥n:', error);
                return false;
            }
        }
        
        // ===== AUTENTICACI√ìN =====
        function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                showAppScreen();
                loadUserData();
                loadDashboardData();
            } else {
                showLoginScreen();
            }
        }
        
        async function handleLogin(email, password) {
            try {
                showLoginAlert('‚è≥ Conectando...', 'info');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Verificar que el sistema est√© configurado
                const isConfigured = await checkSystemConfiguration();
                if (!isConfigured) {
                    await auth.signOut();
                    throw new Error('El sistema no est√° configurado. Ejecuta setup.html primero.');
                }
                
                hideLoginAlert();
                showAppScreen();
                loadUserData();
                loadDashboardData();
                
            } catch (error) {
                let errorMessage = 'Error al iniciar sesi√≥n';
                
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Usuario deshabilitado';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'Usuario no encontrado. Ejecuta setup.html primero.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Contrase√±a incorrecta';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Demasiados intentos. Espera unos minutos.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Error de conexi√≥n a internet';
                        break;
                }
                
                showLoginAlert(`‚ùå ${errorMessage}`);
            }
        }
        
        function loadUserData() {
            const userInitial = document.getElementById('userInitial');
            const userName = document.getElementById('userName');
            
            if (currentUser && userInitial && userName) {
                userInitial.textContent = currentUser.email.charAt(0).toUpperCase();
                userName.textContent = currentUser.email;
            }
        }
        
        // ===== CARGA DE DATOS =====
        function loadSectionData(sectionId) {
            switch(sectionId) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'ingredients':
                    loadIngredients();
                    break;
                case 'recipes':
                    loadRecipes();
                    break;
                case 'production':
                    loadProductions();
                    break;
                case 'shopping':
                    loadShoppingList();
                    break;
                case 'movements':
                    loadMovements();
                    break;
            }
        }
        
        async function loadDashboardData() {
            try {
                // Cargar insumos
                const ingredientsSnapshot = await db.collection('ingredients').get();
                appState.ingredients = [];
                ingredientsSnapshot.forEach(doc => {
                    appState.ingredients.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Cargar recetas
                const recipesSnapshot = await db.collection('recipes').get();
                appState.recipes = [];
                recipesSnapshot.forEach(doc => {
                    appState.recipes.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Cargar producciones de hoy
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const productionsSnapshot = await db.collection('productions')
                    .where('date', '>=', today)
                    .get();
                appState.productions = [];
                productionsSnapshot.forEach(doc => {
                    appState.productions.push({
                        id: doc.id,
                        ...doc.data()
                    });
                });
                
                // Actualizar estad√≠sticas
                document.getElementById('totalIngredients').textContent = appState.ingredients.length;
                document.getElementById('totalRecipes').textContent = appState.recipes.length;
                document.getElementById('totalProductions').textContent = appState.productions.length;
                
                // Calcular insumos con stock bajo
                const lowStockItems = appState.ingredients.filter(i => i.currentStock < i.minStock);
                document.getElementById('lowStockCount').textContent = lowStockItems.length;
                
                // Mostrar lista de stock bajo
                const lowStockList = document.getElementById('lowStockList');
                lowStockList.innerHTML = '';
                
                lowStockItems.forEach(item => {
                    const row = document.createElement('tr');
                    row.className = 'low-stock';
                    row.innerHTML = `
                        <td><strong>${item.name}</strong></td>
                        <td>${item.currentStock} ${item.unit}</td>
                        <td>${item.minStock} ${item.unit}</td>
                        <td><span class="badge badge-danger">STOCK BAJO</span></td>
                    `;
                    lowStockList.appendChild(row);
                });
                
                if (lowStockItems.length === 0) {
                    lowStockList.innerHTML = `
                        <tr>
                            <td colspan="4" class="text-center" style="padding: 40px; color: var(--gris);">
                                üéâ ¬°Todo el stock est√° en niveles adecuados!
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Error cargando datos del dashboard:', error);
                showToast('Error cargando datos del dashboard', 'danger');
            }
        }
        
        async function loadIngredients() {
            try {
                const ingredientsList = document.getElementById('ingredientsList');
                ingredientsList.innerHTML = '<tr><td colspan="6" class="loading">Cargando insumos...</td></tr>';
                
                const snapshot = await db.collection('ingredients').orderBy('name').get();
                appState.ingredients = [];
                ingredientsList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const ingredient = {
                        id: doc.id,
                        ...doc.data()
                    };
                    appState.ingredients.push(ingredient);
                    
                    const row = document.createElement('tr');
                    if (ingredient.currentStock < ingredient.minStock) {
                        row.className = 'low-stock';
                    }
                    
                    row.innerHTML = `
                        <td><strong>${ingredient.name}</strong></td>
                        <td>${ingredient.unit}</td>
                        <td>${ingredient.currentStock} ${ingredient.unit}</td>
                        <td>${ingredient.minStock} ${ingredient.unit}</td>
                        <td>$${ingredient.unitCost.toFixed(2)}/${ingredient.costUnit}</td>
                        <td>
                            <button class="btn btn-rosa btn-sm" onclick="editIngredient('${ingredient.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteIngredient('${ingredient.id}')">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    
                    ingredientsList.appendChild(row);
                });
                
                if (snapshot.empty) {
                    ingredientsList.innerHTML = '<tr><td colspan="6" class="text-center">No hay insumos registrados</td></tr>';
                }
                
            } catch (error) {
                console.error('Error cargando insumos:', error);
                showToast('Error cargando insumos', 'danger');
            }
        }
        
        async function loadRecipes() {
            try {
                const recipesList = document.getElementById('recipesList');
                recipesList.innerHTML = '<tr><td colspan="6" class="loading">Cargando recetas...</td></tr>';
                
                const snapshot = await db.collection('recipes').orderBy('name').get();
                appState.recipes = [];
                recipesList.innerHTML = '';
                
                for (const doc of snapshot.docs) {
                    const recipe = {
                        id: doc.id,
                        ...doc.data()
                    };
                    
                    // Calcular costo total de la receta
                    let totalCost = 0;
                    if (recipe.ingredients && recipe.ingredients.length > 0) {
                        for (const item of recipe.ingredients) {
                            const ingredient = appState.ingredients.find(i => i.id === item.ingredientId);
                            if (ingredient) {
                                totalCost += item.quantity * ingredient.unitCost;
                            }
                        }
                    }
                    
                    const costPerPortion = recipe.portions > 0 ? totalCost / recipe.portions : 0;
                    
                    recipe.totalCost = totalCost;
                    recipe.costPerPortion = costPerPortion;
                    appState.recipes.push(recipe);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${recipe.name}</strong></td>
                        <td>${recipe.description || 'Sin descripci√≥n'}</td>
                        <td>${recipe.portions}</td>
                        <td>$${totalCost.toFixed(2)}</td>
                        <td>$${costPerPortion.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-rosa btn-sm" onclick="viewRecipe('${recipe.id}')">üëÅÔ∏è Ver</button>
                            <button class="btn btn-warning btn-sm" onclick="editRecipe('${recipe.id}')">‚úèÔ∏è Editar</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteRecipe('${recipe.id}')">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    
                    recipesList.appendChild(row);
                }
                
                if (snapshot.empty) {
                    recipesList.innerHTML = '<tr><td colspan="6" class="text-center">No hay recetas registradas</td></tr>';
                }
                
            } catch (error) {
                console.error('Error cargando recetas:', error);
                showToast('Error cargando recetas', 'danger');
            }
        }
        
        async function loadProductions() {
            try {
                const productionsList = document.getElementById('productionsList');
                productionsList.innerHTML = '<tr><td colspan="5" class="loading">Cargando producciones...</td></tr>';
                
                const snapshot = await db.collection('productions')
                    .orderBy('date', 'desc')
                    .limit(50)
                    .get();
                
                productionsList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const production = {
                        id: doc.id,
                        ...doc.data()
                    };
                    
                    const date = production.date.toDate();
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString().slice(0, 5);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${production.recipeName}</td>
                        <td>${production.quantity}</td>
                        <td>$${production.totalCost ? production.totalCost.toFixed(2) : '0.00'}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteProduction('${production.id}')">üóëÔ∏è Eliminar</button>
                        </td>
                    `;
                    
                    productionsList.appendChild(row);
                });
                
                if (snapshot.empty) {
                    productionsList.innerHTML = '<tr><td colspan="5" class="text-center">No hay producciones registradas</td></tr>';
                }
                
            } catch (error) {
                console.error('Error cargando producciones:', error);
                showToast('Error cargando producciones', 'danger');
            }
        }
        
        async function loadShoppingList() {
            try {
                const shoppingListEl = document.getElementById('shoppingList');
                shoppingListEl.innerHTML = '<tr><td colspan="6" class="loading">Generando lista de compras...</td></tr>';
                
                // Obtener insumos con stock bajo
                const lowStockItems = appState.ingredients.filter(i => i.currentStock < i.minStock);
                shoppingListEl.innerHTML = '';
                
                lowStockItems.forEach(item => {
                    const quantityToBuy = item.minStock - item.currentStock;
                    const estimatedCost = quantityToBuy * item.unitCost;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${item.name}</strong></td>
                        <td>${item.currentStock} ${item.unit}</td>
                        <td>${item.minStock} ${item.unit}</td>
                        <td>${quantityToBuy.toFixed(2)} ${item.unit}</td>
                        <td>$${estimatedCost.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="markAsPurchased('${item.id}', ${quantityToBuy})">‚úÖ Comprar</button>
                        </td>
                    `;
                    
                    shoppingListEl.appendChild(row);
                });
                
                if (lowStockItems.length === 0) {
                    shoppingListEl.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center" style="padding: 40px;">
                                üéâ ¬°Todo el stock est√° en niveles adecuados!
                            </td>
                        </tr>
                    `;
                }
                
            } catch (error) {
                console.error('Error cargando lista de compras:', error);
                showToast('Error cargando lista de compras', 'danger');
            }
        }
        
        async function loadMovements() {
            try {
                const movementsList = document.getElementById('movementsList');
                movementsList.innerHTML = '<tr><td colspan="5" class="loading">Cargando movimientos...</td></tr>';
                
                const filter = document.getElementById('movementFilter').value;
                let query = db.collection('stockMovements').orderBy('date', 'desc').limit(100);
                
                if (filter !== 'all') {
                    query = query.where('type', '==', filter);
                }
                
                const snapshot = await query.get();
                movementsList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const movement = {
                        id: doc.id,
                        ...doc.data()
                    };
                    
                    const date = movement.date.toDate();
                    const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString().slice(0, 5);
                    
                    const typeBadge = movement.type === 'ingreso' 
                        ? '<span class="badge badge-success">INGRESO</span>'
                        : '<span class="badge badge-danger">EGRESO</span>';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${formattedDate}</td>
                        <td>${movement.ingredientName}</td>
                        <td>${typeBadge}</td>
                        <td>${movement.quantity} ${movement.unit}</td>
                        <td>${movement.reason}</td>
                    `;
                    
                    movementsList.appendChild(row);
                });
                
                if (snapshot.empty) {
                    movementsList.innerHTML = '<tr><td colspan="5" class="text-center">No hay movimientos registrados</td></tr>';
                }
                
            } catch (error) {
                console.error('Error cargando movimientos:', error);
                showToast('Error cargando movimientos', 'danger');
            }
        }
        
        // ===== FUNCIONES DE GESTI√ìN =====
        // Funciones para insumos
        function editIngredient(ingredientId) {
            const ingredient = appState.ingredients.find(i => i.id === ingredientId);
            if (!ingredient) return;
            
            const modal = document.getElementById('ingredientModal');
            const form = document.getElementById('ingredientForm');
            
            form.reset();
            document.getElementById('ingredientId').value = ingredient.id;
            document.getElementById('ingredientName').value = ingredient.name;
            document.getElementById('ingredientUnit').value = ingredient.unit;
            document.getElementById('ingredientCostUnit').value = ingredient.costUnit;
            document.getElementById('currentStock').value = ingredient.currentStock;
            document.getElementById('minStock').value = ingredient.minStock;
            document.getElementById('unitCost').value = ingredient.unitCost;
            
            document.getElementById('ingredientModalTitle').innerHTML = '<span>‚úèÔ∏è</span> Editar Insumo';
            
            modal.classList.add('active');
        }
        
        async function saveIngredient() {
            try {
                const form = document.getElementById('ingredientForm');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const ingredientData = {
                    name: document.getElementById('ingredientName').value,
                    unit: document.getElementById('ingredientUnit').value,
                    costUnit: document.getElementById('ingredientCostUnit').value,
                    currentStock: parseFloat(document.getElementById('currentStock').value),
                    minStock: parseFloat(document.getElementById('minStock').value),
                    unitCost: parseFloat(document.getElementById('unitCost').value),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const ingredientId = document.getElementById('ingredientId').value;
                
                if (ingredientId) {
                    // Actualizar insumo existente
                    await db.collection('ingredients').doc(ingredientId).update(ingredientData);
                    showToast('Insumo actualizado correctamente', 'success');
                } else {
                    // Crear nuevo insumo
                    ingredientData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                    await db.collection('ingredients').add(ingredientData);
                    showToast('Insumo creado correctamente', 'success');
                }
                
                // Cerrar modal y recargar datos
                closeModal('ingredientModal');
                loadIngredients();
                loadDashboardData();
                
            } catch (error) {
                console.error('Error guardando insumo:', error);
                showToast('Error guardando insumo', 'danger');
            }
        }
        
        async function deleteIngredient(ingredientId) {
            if (!confirm('¬øEst√°s seguro de eliminar este insumo?')) return;
            
            try {
                await db.collection('ingredients').doc(ingredientId).delete();
                showToast('Insumo eliminado correctamente', 'success');
                loadIngredients();
                loadDashboardData();
            } catch (error) {
                console.error('Error eliminando insumo:', error);
                showToast('Error eliminando insumo', 'danger');
            }
        }
        
        // Funciones para recetas (simplificadas por espacio)
        function viewRecipe(recipeId) {
            const recipe = appState.recipes.find(r => r.id === recipeId);
            if (!recipe) return;
            
            alert(`üìã ${recipe.name}\n\nüìù Descripci√≥n: ${recipe.description || 'Sin descripci√≥n'}\nüçΩÔ∏è Porciones: ${recipe.portions}\nüí∞ Costo total: $${recipe.totalCost?.toFixed(2) || '0.00'}\nüí∞ Costo por porci√≥n: $${recipe.costPerPortion?.toFixed(2) || '0.00'}`);
        }
        
        // Funciones para producci√≥n
        async function deleteProduction(productionId) {
            if (!confirm('¬øEst√°s seguro de eliminar este registro de producci√≥n?')) return;
            
            try {
                await db.collection('productions').doc(productionId).delete();
                showToast('Producci√≥n eliminada correctamente', 'success');
                loadProductions();
            } catch (error) {
                console.error('Error eliminando producci√≥n:', error);
                showToast('Error eliminando producci√≥n', 'danger');
            }
        }
        
        // Funciones para compras
        async function markAsPurchased(ingredientId, quantity) {
            const ingredient = appState.ingredients.find(i => i.id === ingredientId);
            if (!ingredient) return;
            
            const purchaseQuantity = parseFloat(prompt(`Ingresa la cantidad comprada de ${ingredient.name}:`, quantity));
            
            if (isNaN(purchaseQuantity) || purchaseQuantity <= 0) {
                showToast('Cantidad inv√°lida', 'warning');
                return;
            }
            
            try {
                // Actualizar stock
                const newStock = ingredient.currentStock + purchaseQuantity;
                await db.collection('ingredients').doc(ingredientId).update({
                    currentStock: newStock
                });
                
                // Registrar movimiento de stock
                await db.collection('stockMovements').add({
                    ingredientId: ingredientId,
                    ingredientName: ingredient.name,
                    type: 'ingreso',
                    quantity: purchaseQuantity,
                    unit: ingredient.unit,
                    reason: 'Compra',
                    date: firebase.firestore.FieldValue.serverTimestamp(),
                    userId: currentUser.uid
                });
                
                showToast('Compra registrada correctamente', 'success');
                loadShoppingList();
                loadIngredients();
                loadDashboardData();
                loadMovements();
                
            } catch (error) {
                console.error('Error registrando compra:', error);
                showToast('Error registrando compra', 'danger');
            }
        }
        
        // ===== FUNCIONES AUXILIARES =====
        function showLoginAlert(message, type = 'danger') {
            loginAlert.textContent = message;
            loginAlert.className = `alert alert-${type}`;
            loginAlert.classList.remove('d-none');
        }
        
        function hideLoginAlert() {
            loginAlert.classList.add('d-none');
        }
        
        function showToast(message, type = 'info') {
            // Crear toast temporal
            const toast = document.createElement('div');
            toast.className = `alert alert-${type}`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                animation: slideIn 0.3s ease;
            `;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span>${type === 'success' ? '‚úÖ' : type === 'danger' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // Auto-eliminar despu√©s de 5 segundos
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (toast.parentElement) {
                        toast.remove();
                    }
                }, 300);
            }, 5000);
            
            // Agregar animaci√≥n de salida
            if (!document.getElementById('slideOutStyle')) {
                const style = document.createElement('style');
                style.id = 'slideOutStyle';
                style.textContent = `
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // ===== FUNCIONES GLOBALES =====
        window.editIngredient = editIngredient;
        window.deleteIngredient = deleteIngredient;
        window.viewRecipe = viewRecipe;
        window.deleteProduction = deleteProduction;
        window.markAsPurchased = markAsPurchased;
        window.closeModal = closeModal;
        
        // Event listeners adicionales para la app principal
        document.getElementById('addIngredientBtn')?.addEventListener('click', () => {
            document.getElementById('ingredientForm').reset();
            document.getElementById('ingredientId').value = '';
            document.getElementById('ingredientModalTitle').innerHTML = '<span>üì¶</span> Nuevo Insumo';
            document.getElementById('ingredientModal').classList.add('active');
        });
        
        document.getElementById('saveIngredientBtn')?.addEventListener('click', saveIngredient);
        
        // Cerrar modales al hacer clic fuera o en el bot√≥n de cerrar
        document.querySelectorAll('.modal-close, .modal-footer .btn-warning').forEach(btn => {
            btn.addEventListener('click', function() {
                const modalId = this.getAttribute('data-modal') || 
                               this.closest('.modal-footer').querySelector('.btn-primary').getAttribute('data-modal');
                if (modalId) closeModal(modalId);
            });
        });
        
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
        
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</body>
</html>
