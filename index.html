<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç∞ Pasteler√≠a Dolcefran - Sistema de Gesti√≥n</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç∞</text></svg>">
    
    <!-- PWA Meta Tags Mejorados -->
    <meta name="theme-color" content="#FF66B2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Pasteler√≠a Dolcefran">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üç∞</text></svg>">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Pasteler√≠a Dolcefran">
    <meta name="description" content="Sistema de gesti√≥n integral para pasteler√≠a">
    
    <!-- Manifest.json embebido -->
    <link rel="manifest" id="app-manifest">
    
    <style>
        /* ===== VARIABLES Y RESET ===== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        :root {
            /* Paleta rosa pastel - Dolcefran */
            --rosa-principal: #FF66B2;
            --rosa-claro: #FF99CC;
            --rosa-suave: #FFCCE0;
            --rosa-fondo: #FFF0F5;
            --rosa-oscuro: #FF3385;
            --lila: #DDA0DD;
            --lila-claro: #E6E6FA;
            --crema: #FFF5EE;
            --dorado: #FFD700;
            --verde-menta: #98FB98;
            --verde-menta-oscuro: #7CFC00;
            --verde-exito: #28a745;
            --gris-claro: #f8f9fa;
            --gris: #6c757d;
            --gris-oscuro: #343a40;
            --blanco: #ffffff;
            --negro: #212529;
            --sombra: 0 8px 30px rgba(255, 102, 178, 0.12);
            --sombra-intensa: 0 15px 40px rgba(255, 102, 178, 0.2);
            --transicion: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        body {
            background: linear-gradient(135deg, var(--rosa-fondo) 0%, var(--lila-claro) 100%);
            color: var(--negro);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* ===== TIPOGRAF√çA ===== */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Dancing+Script:wght@400;500;600;700&display=swap');
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
            color: var(--rosa-oscuro);
        }
        
        .font-dancing {
            font-family: 'Dancing Script', cursive;
        }
        
        /* ===== LOGIN ===== */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: linear-gradient(135deg, var(--rosa-fondo) 0%, var(--lila-claro) 100%);
            position: relative;
            overflow: hidden;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--rosa-claro) 0%, transparent 70%);
            opacity: 0.3;
        }
        
        .login-card {
            background: var(--blanco);
            border-radius: 24px;
            box-shadow: var(--sombra-intensa);
            width: 100%;
            max-width: 450px;
            padding: 50px 40px;
            position: relative;
            z-index: 1;
            border: 2px solid var(--rosa-suave);
            overflow: hidden;
        }
        
        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, var(--rosa-principal), var(--lila));
        }
        
        .login-logo {
            font-size: 72px;
            margin-bottom: 25px;
            text-align: center;
            color: var(--rosa-principal);
            filter: drop-shadow(0 6px 8px rgba(255, 102, 178, 0.3));
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .login-title {
            font-size: 42px;
            margin-bottom: 15px;
            text-align: center;
            color: var(--rosa-oscuro);
            font-family: 'Dancing Script', cursive;
            font-weight: 700;
        }
        
        .login-subtitle {
            color: var(--gris);
            margin-bottom: 40px;
            text-align: center;
            line-height: 1.6;
            font-size: 16px;
        }
        
        /* ===== FORMULARIOS ===== */
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--rosa-oscuro);
            font-size: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--rosa-suave);
            border-radius: 12px;
            font-size: 16px;
            transition: var(--transicion);
            background: var(--blanco);
            color: var(--negro);
        }
        
        .form-control:focus {
            border-color: var(--rosa-principal);
            outline: none;
            box-shadow: 0 0 0 4px rgba(255, 102, 178, 0.15);
            transform: translateY(-2px);
        }
        
        .form-control::placeholder {
            color: var(--gris);
            opacity: 0.6;
        }
        
        /* ===== BOTONES ===== */
        .btn {
            padding: 16px 28px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transicion);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            position: relative;
            overflow: hidden;
            user-select: none;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(40, 40);
                opacity: 0;
            }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--rosa-principal), var(--rosa-oscuro));
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(255, 102, 178, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 102, 178, 0.4);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--verde-exito), #20c997);
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FFB74D, #FF9800);
            color: var(--negro);
            box-shadow: 0 4px 15px rgba(255, 183, 77, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(23, 162, 184, 0.3);
        }
        
        .btn-rosa {
            background: linear-gradient(135deg, var(--rosa-claro), var(--rosa-principal));
            color: var(--blanco);
            box-shadow: 0 4px 15px rgba(255, 102, 178, 0.3);
        }
        
        .btn-sm {
            padding: 10px 18px;
            font-size: 14px;
            border-radius: 10px;
        }
        
        .btn-full {
            width: 100%;
        }
        
        /* ===== ALERTAS ===== */
        .alert {
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 25px;
            border: 2px solid;
            position: relative;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
            border-color: #b1dfbb;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border-color: #f1b0b7;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
            border-color: #ffdf7e;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            color: #0c5460;
            border-color: #abdde5;
        }
        
        .alert-rosa {
            background: linear-gradient(135deg, var(--rosa-suave), var(--rosa-claro));
            color: var(--rosa-oscuro);
            border-color: var(--rosa-principal);
        }
        
        /* ===== APP PRINCIPAL ===== */
        #appScreen {
            display: none;
            min-height: 100vh;
            flex-direction: column;
        }
        
        /* Header de la app */
        .app-header {
            background: linear-gradient(135deg, var(--rosa-principal), var(--rosa-oscuro));
            color: var(--blanco);
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--sombra);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .app-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--dorado), transparent);
        }
        
        .app-logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .app-logo h1 {
            font-size: 26px;
            color: var(--blanco);
            font-family: 'Dancing Script', cursive;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--lila), var(--rosa-claro));
            color: var(--blanco);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            border: 3px solid var(--blanco);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        /* Navegaci√≥n */
        .app-nav {
            background: var(--blanco);
            display: flex;
            overflow-x: auto;
            padding: 0 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            position: sticky;
            top: 88px;
            z-index: 999;
            border-bottom: 2px solid var(--rosa-suave);
        }
        
        .app-nav::-webkit-scrollbar {
            height: 6px;
        }
        
        .app-nav::-webkit-scrollbar-track {
            background: var(--rosa-suave);
            border-radius: 3px;
        }
        
        .app-nav::-webkit-scrollbar-thumb {
            background: var(--rosa-principal);
            border-radius: 3px;
        }
        
        .nav-item {
            padding: 20px 25px;
            white-space: nowrap;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            transition: var(--transicion);
            font-weight: 500;
            color: var(--gris);
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
            user-select: none;
        }
        
        .nav-item:hover {
            background: var(--rosa-suave);
            color: var(--rosa-oscuro);
        }
        
        .nav-item.active {
            color: var(--rosa-oscuro);
            border-bottom-color: var(--rosa-principal);
            background: linear-gradient(to bottom, var(--rosa-suave), transparent);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--rosa-principal), var(--lila));
        }
        
        /* Contenido principal */
        .app-content {
            flex: 1;
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Tarjetas */
        .card {
            background: var(--blanco);
            border-radius: 20px;
            box-shadow: var(--sombra);
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid var(--rosa-suave);
            transition: var(--transicion);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--sombra-intensa);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid var(--rosa-suave);
        }
        
        .card-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--rosa-oscuro);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        /* Estad√≠sticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--rosa-suave), var(--lila-claro));
            border-radius: 18px;
            padding: 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 2px solid var(--rosa-claro);
            transition: var(--transicion);
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(255, 102, 178, 0.15);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: var(--blanco);
            background: linear-gradient(135deg, var(--rosa-principal), var(--lila));
            box-shadow: 0 6px 15px rgba(255, 102, 178, 0.3);
        }
        
        .stat-content h3 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--rosa-oscuro);
        }
        
        .stat-content p {
            color: var(--gris);
            font-size: 15px;
        }
        
        /* Tablas */
        .table-container {
            overflow-x: auto;
            border-radius: 16px;
            border: 2px solid var(--rosa-suave);
            margin-top: 20px;
        }
        
        .table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            background: linear-gradient(135deg, var(--rosa-suave), var(--lila-claro));
            color: var(--rosa-oscuro);
            text-align: left;
            padding: 20px;
            font-weight: 600;
            border-bottom: 3px solid var(--rosa-claro);
            position: sticky;
            top: 0;
        }
        
        .table td {
            padding: 20px;
            border-bottom: 1px solid var(--rosa-suave);
            transition: var(--transicion);
        }
        
        .table tr:hover td {
            background: var(--rosa-suave);
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        /* Badges */
        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .badge-success {
            background: linear-gradient(135deg, var(--verde-menta), var(--verde-menta-oscuro));
            color: var(--negro);
        }
        
        .badge-warning {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: var(--negro);
        }
        
        .badge-danger {
            background: linear-gradient(135deg, #FF6B6B, #FF5252);
            color: var(--blanco);
        }
        
        .badge-rosa {
            background: linear-gradient(135deg, var(--rosa-claro), var(--rosa-principal));
            color: var(--blanco);
        }
        
        .badge-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: var(--blanco);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: var(--blanco);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.4s ease;
            border: 3px solid var(--rosa-claro);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-header {
            padding: 30px;
            border-bottom: 3px solid var(--rosa-suave);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--rosa-suave), transparent);
        }
        
        .modal-title {
            font-size: 26px;
            font-weight: 600;
            color: var(--rosa-oscuro);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--rosa-principal);
            transition: var(--transicion);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            background: var(--rosa-suave);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-footer {
            padding: 25px 30px;
            border-top: 3px solid var(--rosa-suave);
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            background: linear-gradient(135deg, transparent, var(--rosa-suave));
        }
        
        /* Stock bajo */
        .low-stock {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7) !important;
            border-left: 4px solid #ff9800;
        }
        
        .low-stock:hover td {
            background: #ffecb5 !important;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 60px;
            color: var(--gris);
            font-size: 18px;
        }
        
        .loading::after {
            content: "";
            display: inline-block;
            width: 25px;
            height: 25px;
            border: 3px solid var(--rosa-suave);
            border-top: 3px solid var(--rosa-principal);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .login-card {
                padding: 30px 25px;
            }
            
            .app-header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .app-nav {
                top: 138px;
                padding: 0 15px;
            }
            
            .nav-item {
                padding: 18px 20px;
                font-size: 14px;
            }
            
            .app-content {
                padding: 20px;
            }
            
            .card {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                max-height: 85vh;
            }
            
            .login-title {
                font-size: 36px;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-header {
                padding: 20px;
            }
        }
        
        /* Utilidades */
        .d-none {
            display: none !important;
        }
        
        .d-flex {
            display: flex !important;
        }
        
        .d-block {
            display: block !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .mt-1 { margin-top: 5px; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mt-4 { margin-top: 20px; }
        .mt-5 { margin-top: 25px; }
        
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .mb-4 { margin-bottom: 20px; }
        .mb-5 { margin-bottom: 25px; }
        
        .p-3 {
            padding: 15px;
        }
        
        .w-100 {
            width: 100%;
        }
        
        /* Animaciones adicionales */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Scroll personalizado */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--rosa-suave);
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(var(--rosa-principal), var(--lila));
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(var(--rosa-oscuro), var(--rosa-principal));
        }
        
        /* Bot√≥n flotante para PWA */
        #installButton {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--rosa-principal), var(--lila));
            color: var(--blanco);
            border: none;
            border-radius: 50%;
            width: 70px;
            height: 70px;
            font-size: 28px;
            box-shadow: 0 8px 25px rgba(255, 102, 178, 0.4);
            cursor: pointer;
            display: none;
            transition: var(--transicion);
            animation: pulse 2s infinite;
        }
        
        #installButton:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 35px rgba(255, 102, 178, 0.6);
        }
        
        /* Decoraciones */
        .cupcake-decoration {
            position: fixed;
            font-size: 24px;
            opacity: 0.1;
            pointer-events: none;
            z-index: -1;
        }
        
        /* Grid de cupcakes para fondo */
        .cupcakes-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 20px;
            padding: 20px;
            opacity: 0.03;
            z-index: -1;
            pointer-events: none;
        }
        
        .cupcake-item {
            font-size: 40px;
            text-align: center;
            animation: floatCupcake 20s linear infinite;
        }
        
        @keyframes floatCupcake {
            0% {
                transform: translateY(0) rotate(0deg);
            }
            100% {
                transform: translateY(-1000px) rotate(360deg);
            }
        }
        
        /* Ingredientes en recetas */
        .ingredient-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .ingredient-row select,
        .ingredient-row input {
            flex: 1;
        }
        
        .remove-ingredient {
            background: var(--rosa-claro);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--rosa-oscuro);
            transition: var(--transicion);
        }
        
        .remove-ingredient:hover {
            background: var(--rosa-principal);
            color: var(--blanco);
        }
        
        /* Notificaci√≥n de instalaci√≥n */
        .install-prompt {
            position: fixed;
            bottom: 30px;
            left: 30px;
            right: 30px;
            background: linear-gradient(135deg, var(--rosa-principal), var(--lila));
            color: var(--blanco);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: space-between;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(100px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .install-prompt-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex: 1;
        }
        
        .install-prompt-icon {
            font-size: 32px;
        }
        
        .install-prompt-text h4 {
            margin: 0;
            font-size: 16px;
            color: var(--blanco);
        }
        
        .install-prompt-text p {
            margin: 5px 0 0;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .install-prompt-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Ganancias */
        .profit-badge {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            font-weight: bold;
            padding: 8px 16px;
            border-radius: 50px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .profit-positive {
            color: var(--verde-exito);
            font-weight: bold;
        }
        
        .profit-negative {
            color: #FF5252;
            font-weight: bold;
        }
        
        /* Toast personalizado */
        .custom-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            background: var(--blanco);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-left: 4px solid var(--rosa-principal);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 9999;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .custom-toast.hide {
            animation: slideOutRight 0.3s ease;
            opacity: 0;
            transform: translateX(100%);
        }
        
        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100%);
            }
        }
        
        .toast-icon {
            font-size: 20px;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--gris);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .toast-close:hover {
            background: var(--rosa-suave);
        }
        
        /* Estilos para input group */
        .input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .input-group .form-control {
            flex: 1;
        }
        
        /* Estilos para secciones de ganancias */
        .profit-section {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 16px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .profit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .profit-card {
            background: var(--blanco);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--rosa-suave);
            text-align: center;
        }
        
        .profit-card h4 {
            margin-bottom: 10px;
            color: var(--gris);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .profit-card .amount {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .profit-card .subtext {
            font-size: 12px;
            color: var(--gris);
        }
        
        /* Precios de venta en recetas */
        .selling-price-input {
            position: relative;
        }
        
        .selling-price-input::before {
            content: '$';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--rosa-oscuro);
            font-weight: bold;
            z-index: 1;
        }
        
        .selling-price-input input {
            padding-left: 30px !important;
        }
    </style>
</head>
<body>
    <!-- Fondo decorativo de cupcakes -->
    <div class="cupcakes-grid" id="cupcakesGrid"></div>
    
    <!-- Notificaci√≥n de instalaci√≥n PWA -->
    <div id="installPrompt" class="install-prompt">
        <div class="install-prompt-content">
            <div class="install-prompt-icon">üì±</div>
            <div class="install-prompt-text">
                <h4>Instalar Pasteler√≠a Dolcefran</h4>
                <p>Instala esta aplicaci√≥n en tu dispositivo para un acceso m√°s r√°pido y experiencia offline.</p>
            </div>
        </div>
        <div class="install-prompt-actions">
            <button id="installLaterBtn" class="btn btn-sm btn-rosa">M√°s tarde</button>
            <button id="installNowBtn" class="btn btn-sm btn-success">Instalar</button>
        </div>
    </div>
    
    <!-- Bot√≥n para instalar como PWA -->
    <button id="installButton" title="Instalar aplicaci√≥n">üì±</button>
    
    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-logo">üç∞</div>
            <h1 class="login-title font-dancing">Pasteler√≠a Dolcefran</h1>
            <p class="login-subtitle">Sistema de gesti√≥n integral para tu pasteler√≠a</p>
            
            <div id="loginAlert" class="alert alert-danger d-none"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <input type="email" id="loginEmail" class="form-control" placeholder="Correo electr√≥nico" required 
                           value="admin@dolcefran.com">
                </div>
                
                <div class="form-group">
                    <input type="password" id="loginPassword" class="form-control" placeholder="Contrase√±a" required
                           value="admin123">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary pulse btn-full">üîë Iniciar Sesi√≥n</button>
                </div>
            </form>
            
            <div class="text-center mt-3">
                <p><small>Credenciales por defecto: admin@dolcefran.com / admin123</small></p>
                <p><small>üíñ Sistema conectado a Firebase</small></p>
            </div>
        </div>
    </div>
    
    <!-- Pantalla 3: Aplicaci√≥n principal -->
    <div id="appScreen">
        <!-- Header -->
        <div class="app-header">
            <div class="app-logo">
                <div style="font-size: 32px;">üç∞</div>
                <h1 class="font-dancing">Pasteler√≠a Dolcefran</h1>
            </div>
            
            <div class="user-info">
                <div class="user-avatar" id="userInitial">D</div>
                <div>
                    <div id="userName" style="font-weight: 500;">admin@dolcefran.com</div>
                    <button id="logoutBtn" class="btn btn-danger btn-sm">üö™ Salir</button>
                </div>
            </div>
        </div>
        
        <!-- Navegaci√≥n -->
        <div class="app-nav">
            <div class="nav-item active" data-section="dashboard">
                üìä Dashboard
            </div>
            <div class="nav-item" data-section="ingredients">
                üì¶ Insumos
            </div>
            <div class="nav-item" data-section="recipes">
                üìí Recetas
            </div>
            <div class="nav-item" data-section="production">
                üè≠ Producci√≥n
            </div>
            <div class="nav-item" data-section="shopping">
                üõí Compras
            </div>
            <div class="nav-item" data-section="movements">
                üìú Movimientos
            </div>
        </div>
        
        <!-- Contenido principal -->
        <div class="app-content">
            <!-- Dashboard -->
            <section id="dashboard" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìä</span> Dashboard - Resumen General
                        </h2>
                        <button id="refreshDashboard" class="btn btn-primary btn-sm">
                            üîÑ Actualizar
                        </button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card" onclick="showSection('ingredients')">
                            <div class="stat-icon">üì¶</div>
                            <div class="stat-content">
                                <h3 id="totalIngredients">0</h3>
                                <p>Insumos Registrados</p>
                            </div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('shopping')">
                            <div class="stat-icon">‚ö†Ô∏è</div>
                            <div class="stat-content">
                                <h3 id="lowStockCount">0</h3>
                                <p>Insumos con Stock Bajo</p>
                            </div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('recipes')">
                            <div class="stat-icon">üìí</div>
                            <div class="stat-content">
                                <h3 id="totalRecipes">0</h3>
                                <p>Recetas Registradas</p>
                            </div>
                        </div>
                        
                        <div class="stat-card" onclick="showSection('production')">
                            <div class="stat-icon">üè≠</div>
                            <div class="stat-content">
                                <h3 id="totalProductions">0</h3>
                                <p>Producciones Hoy</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Secci√≥n de Ganancias -->
                    <div class="profit-section">
                        <h3 style="color: var(--rosa-oscuro); margin-bottom: 20px;">üí∞ An√°lisis de Ganancias</h3>
                        <div class="profit-grid">
                            <div class="profit-card">
                                <h4>Ganancias Hoy</h4>
                                <div class="amount" id="profitToday">$0.00</div>
                                <div class="subtext">Ventas - Costos de hoy</div>
                            </div>
                            
                            <div class="profit-card">
                                <h4>Ganancias del Mes</h4>
                                <div class="amount" id="profitMonth">$0.00</div>
                                <div class="subtext">Ventas - Costos del mes</div>
                            </div>
                            
                            <div class="profit-card">
                                <h4>Margen de Ganancia</h4>
                                <div class="amount" id="profitMargin">0%</div>
                                <div class="subtext">Porcentaje de ganancia</div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h4 style="color: var(--gris); margin-bottom: 15px;">üìà Producciones Recientes con Ganancia</h4>
                            <div class="table-container">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Receta</th>
                                            <th>Cantidad</th>
                                            <th>Costo</th>
                                            <th>Venta</th>
                                            <th>Ganancia</th>
                                        </tr>
                                    </thead>
                                    <tbody id="profitList">
                                        <!-- Datos cargados din√°micamente -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <h3 class="mb-3 mt-5" style="color: var(--rosa-oscuro);">‚ö†Ô∏è Insumos con Stock Bajo</h3>
                    <div class="table-container">
                        <table class="table" id="lowStockTable">
                            <thead>
                                <tr>
                                    <th>Insumo</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Insumos -->
            <section id="ingredients" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üì¶</span> Gesti√≥n de Insumos
                        </h2>
                        <button id="addIngredientBtn" class="btn btn-primary">
                            ‚ûï Nuevo Insumo
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Unidad</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Costo Unitario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="ingredientsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Recetas -->
            <section id="recipes" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìí</span> Gesti√≥n de Recetas
                        </h2>
                        <button id="addRecipeBtn" class="btn btn-primary">
                            ‚ûï Nueva Receta
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Descripci√≥n</th>
                                    <th>Porciones</th>
                                    <th>Costo Total</th>
                                    <th>Precio Venta</th>
                                    <th>Ganancia/Unidad</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="recipesList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Producci√≥n -->
            <section id="production" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üè≠</span> Registro de Producci√≥n
                        </h2>
                        <button id="registerProductionBtn" class="btn btn-primary">
                            üè≠ Registrar Producci√≥n
                        </button>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Receta</th>
                                    <th>Cantidad</th>
                                    <th>Costo Total</th>
                                    <th>Venta Total</th>
                                    <th>Ganancia</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="productionsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Compras -->
            <section id="shopping" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üõí</span> Lista de Compras
                        </h2>
                        <button id="refreshShoppingList" class="btn btn-primary btn-sm">
                            üîÑ Actualizar
                        </button>
                    </div>
                    
                    <div class="alert alert-rosa">
                        <strong>üéÄ Lista autom√°tica:</strong> Se generan los insumos que tienen stock por debajo del m√≠nimo.
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Insumo</th>
                                    <th>Stock Actual</th>
                                    <th>Stock M√≠nimo</th>
                                    <th>Cantidad a Comprar</th>
                                    <th>Costo Estimado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="shoppingList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- Movimientos -->
            <section id="movements" class="section d-none">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <span>üìú</span> Movimientos de Stock
                        </h2>
                        <div>
                            <select id="movementFilter" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;">
                                <option value="all">Todos los movimientos</option>
                                <option value="ingreso">Ingresos</option>
                                <option value="egreso">Egresos</option>
                            </select>
                            <button id="refreshMovements" class="btn btn-primary btn-sm">
                                üîÑ Actualizar
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Insumo</th>
                                    <th>Tipo</th>
                                    <th>Cantidad</th>
                                    <th>Motivo</th>
                                </tr>
                            </thead>
                            <tbody id="movementsList">
                                <!-- Datos cargados din√°micamente -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal para Insumos -->
    <div id="ingredientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="ingredientModalTitle">
                    <span>üì¶</span> Nuevo Insumo
                </h3>
                <button class="modal-close" data-modal="ingredientModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="ingredientForm">
                    <input type="hidden" id="ingredientId">
                    
                    <div class="form-group">
                        <label class="form-label" for="ingredientName">Nombre del Insumo *</label>
                        <input type="text" id="ingredientName" class="form-control" placeholder="Ej: Harina de Trigo" required>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label" for="ingredientUnit">Unidad de Medida *</label>
                            <select id="ingredientUnit" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="g">Gramos (g)</option>
                                <option value="kg">Kilogramos (kg)</option>
                                <option value="ml">Mililitros (ml)</option>
                                <option value="l">Litros (l)</option>
                                <option value="u">Unidades (u)</option>
                                <option value="pz">Piezas (pz)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="ingredientCostUnit">Unidad de Costo *</label>
                            <select id="ingredientCostUnit" class="form-control" required>
                                <option value="">Seleccionar</option>
                                <option value="g">Por gramo</option>
                                <option value="kg">Por kilogramo</option>
                                <option value="ml">Por mililitro</option>
                                <option value="l">Por litro</option>
                                <option value="u">Por unidad</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label" for="currentStock">Stock Actual *</label>
                            <input type="number" id="currentStock" class="form-control" step="0.01" placeholder="0.00" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="minStock">Stock M√≠nimo *</label>
                            <input type="number" id="minStock" class="form-control" step="0.01" placeholder="0.00" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="unitCost">Costo Unitario ($) *</label>
                        <input type="number" id="unitCost" class="form-control" step="0.01" min="0" placeholder="0.00" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="ingredientModal">Cancelar</button>
                <button id="saveIngredientBtn" class="btn btn-primary">üíæ Guardar Insumo</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Recetas -->
    <div id="recipeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="recipeModalTitle">
                    <span>üìí</span> Nueva Receta
                </h3>
                <button class="modal-close" data-modal="recipeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="recipeForm">
                    <input type="hidden" id="recipeId">
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeName">Nombre de la Receta *</label>
                        <input type="text" id="recipeName" class="form-control" placeholder="Ej: Pastel de Chocolate Premium" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeDescription">Descripci√≥n</label>
                        <textarea id="recipeDescription" class="form-control" rows="3" placeholder="Describe la receta..."></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label class="form-label" for="recipePortions">N√∫mero de Porciones *</label>
                            <input type="number" id="recipePortions" class="form-control" min="1" placeholder="8" required>
                        </div>
                        
                        <div class="form-group selling-price-input">
                            <label class="form-label" for="sellingPrice">Precio de Venta ($) *</label>
                            <input type="number" id="sellingPrice" class="form-control" step="0.01" min="0" placeholder="0.00" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üéÄ Ingredientes</label>
                        <div id="recipeIngredientsContainer">
                            <!-- Ingredientes se a√±adir√°n din√°micamente -->
                        </div>
                        <button type="button" id="addIngredientToRecipe" class="btn btn-rosa btn-sm mt-2">
                            ‚ûï A√±adir Ingrediente
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="recipeInstructions">Instrucciones</label>
                        <textarea id="recipeInstructions" class="form-control" rows="4" placeholder="1. Mezclar los ingredientes secos..."></textarea>
                    </div>
                    
                    <div id="recipeCostSummary" class="alert alert-info d-none">
                        <strong>üí∞ Resumen de Costos:</strong>
                        <div>Costo Total: <span id="totalCostPreview">$0.00</span></div>
                        <div>Costo por Porci√≥n: <span id="costPerPortionPreview">$0.00</span></div>
                        <div>Ganancia por Porci√≥n: <span id="profitPerPortionPreview">$0.00</span></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="recipeModal">Cancelar</button>
                <button id="saveRecipeBtn" class="btn btn-primary">üíæ Guardar Receta</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Producci√≥n -->
    <div id="productionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>üè≠</span> Registrar Producci√≥n
                </h3>
                <button class="modal-close" data-modal="productionModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productionForm">
                    <div class="form-group">
                        <label class="form-label" for="productionRecipe">Receta *</label>
                        <select id="productionRecipe" class="form-control" required>
                            <option value="">Seleccionar receta</option>
                            <!-- Opciones cargadas din√°micamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="productionQuantity">Cantidad Producida *</label>
                        <input type="number" id="productionQuantity" class="form-control" min="1" placeholder="1" required>
                        <small style="color: var(--gris);">N√∫mero de unidades/batches producidos</small>
                    </div>
                    
                    <div id="productionInfo" class="alert alert-info">
                        <!-- Informaci√≥n de la receta seleccionada -->
                        Selecciona una receta para ver los detalles
                    </div>
                    
                    <div id="productionValidation" class="alert alert-warning d-none">
                        <!-- Validaci√≥n de stock -->
                    </div>
                    
                    <div id="productionProfit" class="alert alert-success d-none">
                        <!-- C√°lculo de ganancias -->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" data-modal="productionModal">Cancelar</button>
                <button id="saveProductionBtn" class="btn btn-primary" disabled>üè≠ Registrar Producci√≥n</button>
            </div>
        </div>
    </div>
    
    <!-- Script principal -->
    <script>
        // ===== CONFIGURACI√ìN DE FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyCn-IxmpSh1PNg81zDCd8GUC7imM9XXAVA",
            authDomain: "dolcefranrecetas.firebaseapp.com",
            databaseURL: "https://dolcefranrecetas-default-rtdb.firebaseio.com",
            projectId: "dolcefranrecetas",
            storageBucket: "dolcefranrecetas.firebasestorage.app",
            messagingSenderId: "322101534324",
            appId: "1:322101534324:web:e95dee5189edd3309ffb21"
        };
        
        // ===== VARIABLES GLOBALES =====
        let db = null;
        let auth = null;
        let currentUser = null;
        let isSystemConfigured = false;
        let deferredPrompt = null;
        let installPromptShown = false;
        
        // Estado de la aplicaci√≥n
        const appState = {
            ingredients: [],
            recipes: [],
            productions: [],
            shoppingList: [],
            movements: [],
            profits: {
                today: 0,
                month: 0,
                margin: 0
            }
        };
        
        // ===== ELEMENTOS DOM =====
        const loginScreen = document.getElementById('loginScreen');
        const appScreen = document.getElementById('appScreen');
        const loginForm = document.getElementById('loginForm');
        const loginAlert = document.getElementById('loginAlert');
        const installButton = document.getElementById('installButton');
        const installPrompt = document.getElementById('installPrompt');
        const installNowBtn = document.getElementById('installNowBtn');
        const installLaterBtn = document.getElementById('installLaterBtn');
        const appManifest = document.getElementById('app-manifest');
        
        // ===== INICIALIZACI√ìN =====
        document.addEventListener('DOMContentLoaded', () => {
            // Crear fondo decorativo de cupcakes
            createCupcakeBackground();
            
            // Configurar manifest para PWA
            setupManifest();
            
            // Inicializar Firebase
            initializeFirebase();
            
            // Inicializar eventos
            initializeEventListeners();
            
            // Verificar si ya est√° instalada
            checkIfInstalled();
        });
        
        // ===== FUNCIONES DE INICIALIZACI√ìN =====
        function createCupcakeBackground() {
            const grid = document.getElementById('cupcakesGrid');
            const cupcakes = ['üç∞', 'üßÅ', 'üéÇ', 'üçÆ', 'üç©', 'üç™', 'ü•ê', 'ü•®', 'ü•û', 'üç´', 'üç¨', 'üç≠'];
            
            for (let i = 0; i < 50; i++) {
                const cupcake = document.createElement('div');
                cupcake.className = 'cupcake-item';
                cupcake.textContent = cupcakes[Math.floor(Math.random() * cupcakes.length)];
                cupcake.style.animationDelay = `${Math.random() * 20}s`;
                cupcake.style.fontSize = `${Math.random() * 30 + 20}px`;
                cupcake.style.opacity = Math.random() * 0.05 + 0.02;
                grid.appendChild(cupcake);
            }
        }
        
        function setupManifest() {
            // Crear un manifest v√°lido para PWA
            const manifest = {
                "name": "Pasteler√≠a Dolcefran",
                "short_name": "Dolcefran",
                "description": "Sistema de gesti√≥n integral para pasteler√≠a",
                "start_url": ".",
                "display": "standalone",
                "background_color": "#FFF0F5",
                "theme_color": "#FF66B2",
                "orientation": "portrait",
                "icons": [
                    {
                        "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∞</text></svg>",
                        "sizes": "192x192",
                        "type": "image/svg+xml",
                        "purpose": "any maskable"
                    },
                    {
                        "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üç∞</text></svg>",
                        "sizes": "512x512",
                        "type": "image/svg+xml",
                        "purpose": "any maskable"
                    }
                ],
                "categories": ["business", "productivity", "food"],
                "shortcuts": [
                    {
                        "name": "Nueva Receta",
                        "short_name": "Receta",
                        "description": "Crear nueva receta",
                        "url": "/?new-recipe",
                        "icons": [{
                            "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìí</text></svg>",
                            "sizes": "96x96"
                        }]
                    },
                    {
                        "name": "Registrar Producci√≥n",
                        "short_name": "Producci√≥n",
                        "description": "Registrar nueva producci√≥n",
                        "url": "/?new-production",
                        "icons": [{
                            "src": "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè≠</text></svg>",
                            "sizes": "96x96"
                        }]
                    }
                ]
            };
            
            // Convertir manifest a data URL
            const manifestString = JSON.stringify(manifest);
            const manifestDataUrl = 'data:application/manifest+json,' + encodeURIComponent(manifestString);
            
            // Establecer el href del manifest
            appManifest.href = manifestDataUrl;
            
            console.log('Manifest configurado para PWA');
        }
        
        function checkIfInstalled() {
            // Verificar si la app ya est√° instalada
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                console.log('La aplicaci√≥n ya est√° instalada');
                installButton.style.display = 'none';
                installPromptShown = true;
                return true;
            }
            return false;
        }
        
        function initializeEventListeners() {
            // Login
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await handleLogin(email, password);
            });
            
            // App principal
            document.getElementById('logoutBtn')?.addEventListener('click', () => {
                auth.signOut();
                showLoginScreen();
            });
            
            // Navegaci√≥n
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    // Remover clase active de todos
                    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(section => section.classList.add('d-none'));
                    
                    // Activar el seleccionado
                    item.classList.add('active');
                    const sectionId = item.getAttribute('data-section');
                    document.getElementById(sectionId).classList.remove('d-none');
                    
                    // Cargar datos espec√≠ficos de la secci√≥n
                    loadSectionData(sectionId);
                });
            });
            
            // Botones de acci√≥n
            document.getElementById('addIngredientBtn')?.addEventListener('click', () => {
                document.getElementById('ingredientForm').reset();
                document.getElementById('ingredientId').value = '';
                document.getElementById('ingredientModalTitle').innerHTML = '<span>üì¶</span> Nuevo Insumo';
                document.getElementById('ingredientModal').classList.add('active');
            });
            
            document.getElementById('addRecipeBtn')?.addEventListener('click', () => {
                document.getElementById('recipeForm').reset();
                document.getElementById('recipeId').value = '';
                document.getElementById('recipeModalTitle').innerHTML = '<span>üìí</span> Nueva Receta';
                document.getElementById('recipeIngredientsContainer').innerHTML = '';
                document.getElementById('recipeCostSummary').classList.add('d-none');
                addIngredientRowToRecipe();
                document.getElementById('recipeModal').classList.add('active');
            });
            
            document.getElementById('registerProductionBtn')?.addEventListener('click', () => {
                openProductionModal();
            });
            
            document.getElementById('refreshDashboard')?.addEventListener('click', () => {
                loadDashboardData();
            });
            
            document.getElementById('refreshShoppingList')?.addEventListener('click', () => {
                loadShoppingList();
            });
            
            document.getElementById('refreshMovements')?.addEventListener('click', () => {
                loadMovements();
            });
            
            // Guardar insumo
            document.getElementById('saveIngredientBtn')?.addEventListener('click', saveIngredient);
            
            // Guardar receta
            document.getElementById('saveRecipeBtn')?.addEventListener('click', saveRecipe);
            
            // A√±adir ingrediente a receta
            document.getElementById('addIngredientToRecipe')?.addEventListener('click', addIngredientRowToRecipe);
            
            // Producci√≥n
            document.getElementById('productionRecipe')?.addEventListener('change', updateProductionInfo);
            document.getElementById('productionQuantity')?.addEventListener('input', updateProductionInfo);
            document.getElementById('saveProductionBtn')?.addEventListener('click', saveProduction);
            
            // PWA - Instalaci√≥n
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('‚úÖ Evento beforeinstallprompt capturado');
                e.preventDefault();
                deferredPrompt = e;
                
                // Mostrar bot√≥n de instalaci√≥n inmediatamente
                installButton.style.display = 'block';
                
                // Mostrar el prompt personalizado despu√©s de 3 segundos
                setTimeout(() => {
                    if (!installPromptShown && deferredPrompt) {
                        showInstallPrompt();
                    }
                }, 3000);
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('üéâ Aplicaci√≥n instalada con √©xito');
                deferredPrompt = null;
                installButton.style.display = 'none';
                installPrompt.style.display = 'none';
                installPromptShown = true;
                showToast('üéâ ¬°Aplicaci√≥n instalada con √©xito!', 'success');
            });
            
            installButton.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    showToast('No se puede instalar en este momento', 'warning');
                    return;
                }
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`Resultado de la instalaci√≥n: ${outcome}`);
                    
                    if (outcome === 'accepted') {
                        installButton.style.display = 'none';
                        installPrompt.style.display = 'none';
                        installPromptShown = true;
                        showToast('¬°Aplicaci√≥n instalada con √©xito!', 'success');
                    } else {
                        showToast('Instalaci√≥n cancelada', 'info');
                        // Volver a mostrar despu√©s de 1 hora
                        localStorage.setItem('installPromptDismissed', Date.now());
                    }
                    
                    deferredPrompt = null;
                } catch (error) {
                    console.error('Error al instalar:', error);
                    showToast('Error al instalar la aplicaci√≥n', 'danger');
                }
            });
            
            installNowBtn?.addEventListener('click', async () => {
                if (!deferredPrompt) {
                    showToast('No se puede instalar en este momento', 'warning');
                    return;
                }
                
                try {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    
                    if (outcome === 'accepted') {
                        installPrompt.style.display = 'none';
                        installPromptShown = true;
                    } else {
                        // Volver a mostrar despu√©s de 1 hora
                        localStorage.setItem('installPromptDismissed', Date.now());
                    }
                    
                    deferredPrompt = null;
                } catch (error) {
                    console.error('Error al instalar:', error);
                    showToast('Error al instalar la aplicaci√≥n', 'danger');
                }
            });
            
            installLaterBtn?.addEventListener('click', () => {
                installPrompt.style.display = 'none';
                installPromptShown = true;
                // Volver a mostrar despu√©s de 24 horas
                localStorage.setItem('installPromptDismissed', Date.now());
            });
            
            // Cerrar modales
            document.querySelectorAll('.modal-close, .modal-footer .btn-warning').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    if (modalId) closeModal(modalId);
                });
            });
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                    }
                });
            });
            
            // Filtro de movimientos
            document.getElementById('movementFilter')?.addEventListener('change', loadMovements);
            
            // Eventos para actualizar vista previa de costos
            document.getElementById('recipePortions')?.addEventListener('input', updateRecipeCostPreview);
            document.getElementById('sellingPrice')?.addEventListener('input', updateRecipeCostPreview);
        }
        
        // ===== MANEJO DE PANTALLAS =====
        function showLoginScreen() {
            loginScreen.classList.remove('d-none');
            appScreen.style.display = 'none';
            hideLoginAlert();
        }
        
        function showAppScreen() {
            loginScreen.classList.add('d-none');
            appScreen.style.display = 'flex';
            
            // Despu√©s de mostrar la app, verificar instalaci√≥n
            setTimeout(checkInstallPrompt, 2000);
        }
        
        // ===== CONFIGURACI√ìN DE FIREBASE =====
        async function initializeFirebase() {
            try {
                // Inicializar Firebase solo si no est√° ya inicializado
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                } else {
                    firebase.app(); // Si ya est√° inicializado, usa esa instancia
                }
                
                // Inicializar servicios
                db = firebase.firestore();
                auth = firebase.auth();
                
                // Configurar Firestore
                db.settings({
                    ignoreUndefinedProperties: true
                });
                
                // Configurar listener de autenticaci√≥n
                auth.onAuthStateChanged(handleAuthStateChange);
                
                // Verificar si el sistema est√° configurado
                isSystemConfigured = await checkSystemConfiguration();
                
                if (!isSystemConfigured) {
                    showLoginAlert('‚ö†Ô∏è Sistema no configurado', 'warning');
                }
                
                return true;
            } catch (error) {
                console.error('Error inicializando Firebase:', error);
                showLoginAlert('‚ùå Error de conexi√≥n a Firebase: ' + error.message, 'danger');
                return false;
            }
        }
        
        async function checkSystemConfiguration() {
            try {
                const configDoc = await db.collection('systemConfig').doc('setup').get();
                return configDoc.exists && configDoc.data().setupCompleted;
            } catch (error) {
                console.error('Error verificando configuraci√≥n:', error);
                return false;
            }
        }
        
        // ===== AUTENTICACI√ìN =====
        function handleAuthStateChange(user) {
            if (user) {
                currentUser = user;
                showAppScreen();
                loadUserData();
                loadDashboardData();
            } else {
                showLoginScreen();
            }
        }
        
        async function handleLogin(email, password) {
            try {
                showLoginAlert('‚è≥ Conectando...', 'info');
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Verificar que el sistema est√© configurado
                const isConfigured = await checkSystemConfiguration();
                if (!isConfigured) {
                    await auth.signOut();
                    throw new Error('El sistema no est√° configurado.');
                }
                
                hideLoginAlert();
                showAppScreen();
                loadUserData();
                loadDashboardData();
                
            } catch (error) {
                let errorMessage = 'Error al iniciar sesi√≥n';
                
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'Email inv√°lido';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'Usuario deshabilitado';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'Usuario no encontrado';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Contrase√±a incorrecta';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'Demasiados intentos. Espera unos minutos.';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'Error de conexi√≥n a internet';
                        break;
                }
                
                showLoginAlert(`‚ùå ${errorMessage}`);
            }
        }
        
        function loadUserData() {
            const userInitial = document.getElementById('userInitial');
            const userName = document.getElementById('userName');
            
            if (currentUser && userInitial && userName) {
                userInitial.textContent = currentUser.email.charAt(0).toUpperCase();
                userName.textContent = currentUser.email;
            }
        }
        
        // ===== PWA - INSTALACI√ìN =====
        function showInstallPrompt() {
            // Verificar si ya se mostr√≥ recientemente
            const lastDismissed = localStorage.getItem('installPromptDismissed');
            if (lastDismissed) {
                const hoursSinceDismissed = (Date.now() - parseInt(lastDismissed)) / (1000 * 60 * 60);
                if (hoursSinceDismissed < 24) {
                    return; // No mostrar si se despidi√≥ hace menos de 24 horas
                }
            }
            
            // Verificar si ya est√° instalada
            if (checkIfInstalled()) {
                return;
            }
            
            // Verificar si hay un prompt disponible
            if (!deferredPrompt) {
                return;
            }
            
            // Mostrar prompt
            installPrompt.style.display = 'flex';
            installPromptShown = true;
            
            console.log('üì± Mostrando prompt de instalaci√≥n');
        }
        
        function checkInstallPrompt() {
            // Verificar si debemos mostrar el prompt
            if (!checkIfInstalled() && deferredPrompt && !installPromptShown) {
                setTimeout(() => {
                    showInstallPrompt();
                }, 3000);
            }
        }
        
        // [El resto del c√≥digo JavaScript se mantiene igual que en la versi√≥n anterior...]
        // Nota: Para mantener la respuesta concisa, el resto del c√≥digo JavaScript
        // (funciones de carga de datos, gesti√≥n, etc.) se mantiene igual.
        // Solo se muestran las partes modificadas para la PWA.
        
        // ===== FUNCIONES AUXILIARES =====
        function showLoginAlert(message, type = 'danger') {
            loginAlert.textContent = message;
            loginAlert.className = `alert alert-${type}`;
            loginAlert.classList.remove('d-none');
        }
        
        function hideLoginAlert() {
            loginAlert.classList.add('d-none');
        }
        
        function showToast(message, type = 'info', duration = 5000) {
            // Crear toast
            const toast = document.createElement('div');
            toast.className = `custom-toast`;
            toast.innerHTML = `
                <div class="toast-icon">${type === 'success' ? '‚úÖ' : type === 'danger' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è'}</div>
                <div class="toast-content">${message}</div>
                <button class="toast-close">&times;</button>
            `;
            
            document.body.appendChild(toast);
            
            // Evento para cerrar
            toast.querySelector('.toast-close').addEventListener('click', () => {
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 300);
            });
            
            // Auto-eliminar despu√©s de la duraci√≥n
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.classList.add('hide');
                    setTimeout(() => toast.remove(), 300);
                }
            }, duration);
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
        }
        
        function showSection(sectionId) {
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.add('d-none'));
            
            const navItem = document.querySelector(`[data-section="${sectionId}"]`);
            if (navItem) navItem.classList.add('active');
            
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.remove('d-none');
                loadSectionData(sectionId);
            }
        }
        
        // ===== FUNCIONES GLOBALES =====
        window.editIngredient = editIngredient;
        window.deleteIngredient = deleteIngredient;
        window.viewRecipe = viewRecipe;
        window.editRecipe = editRecipe;
        window.deleteRecipe = deleteRecipe;
        window.deleteProduction = deleteProduction;
        window.markAsPurchased = markAsPurchased;
        window.closeModal = closeModal;
        window.showSection = showSection;
        window.updateIngredientUnit = updateIngredientUnit;
        window.removeIngredientRow = removeIngredientRow;
        
        // Inicializar las funciones que faltan (deber√≠an estar definidas en tu c√≥digo original)
        // Estas son solo declaraciones para evitar errores
        function editIngredient() {}
        function deleteIngredient() {}
        function viewRecipe() {}
        function editRecipe() {}
        function deleteRecipe() {}
        function deleteProduction() {}
        function markAsPurchased() {}
        function updateIngredientUnit() {}
        function removeIngredientRow() {}
        
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</body>
</html>
