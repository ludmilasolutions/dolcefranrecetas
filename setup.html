<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuraci√≥n - Pasteler√≠a Pro</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #8B4513 0%, #D2691E 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content {
            padding: 30px;
        }
        
        .setup-block {
            background-color: #f8f9fa;
            border-left: 5px solid #D2691E;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .setup-block.warning {
            border-left-color: #ff9800;
            background-color: #fff3cd;
        }
        
        .setup-block.success {
            border-left-color: #4CAF50;
            background-color: #d4edda;
        }
        
        .setup-block h2 {
            color: #8B4513;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .setup-block.warning h2 {
            color: #856404;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus {
            border-color: #D2691E;
            outline: none;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(90deg, #8B4513 0%, #D2691E 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 69, 19, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #ff9800 0%, #ffb74d 100%);
        }
        
        .logs-container {
            background-color: #1a1a1a;
            color: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .log-item {
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #333;
        }
        
        .log-success {
            color: #4CAF50;
        }
        
        .log-error {
            color: #f44336;
        }
        
        .log-info {
            color: #2196F3;
        }
        
        .log-warning {
            color: #ff9800;
        }
        
        .alert {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-danger {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            counter-reset: step;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .step:before {
            counter-increment: step;
            content: counter(step);
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            display: block;
            margin: 0 auto 10px;
            font-weight: bold;
            color: #666;
        }
        
        .step.active:before {
            background-color: #D2691E;
            color: white;
        }
        
        .step.completed:before {
            background-color: #4CAF50;
            color: white;
        }
        
        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 20px;
            right: -50%;
            width: 100%;
            height: 2px;
            background-color: #ddd;
            z-index: -1;
        }
        
        .step.completed:after {
            background-color: #4CAF50;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 14px;
            border-top: 1px solid #eee;
        }
        
        .hidden {
            display: none;
        }
        
        .code-block {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .instructions {
            margin: 20px 0;
        }
        
        .instructions ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üç∞ Pasteler√≠a Pro - Configuraci√≥n</h1>
            <p>Configuraci√≥n inicial del sistema de gesti√≥n de pasteler√≠a</p>
        </div>
        
        <div class="content">
            <div class="steps">
                <div class="step active">1. Credenciales</div>
                <div class="step">2. Reglas Firebase</div>
                <div class="step">3. Inicializar BD</div>
                <div class="step">4. Completado</div>
            </div>
            
            <div id="alreadyConfigured" class="alert alert-success hidden">
                ‚úÖ Sistema ya inicializado. Puedes cerrar esta p√°gina y acceder a la aplicaci√≥n principal.
            </div>
            
            <div id="setupForm">
                <!-- Paso 1: Credenciales Firebase -->
                <div class="setup-block">
                    <h2>1. Configuraci√≥n de Firebase</h2>
                    <p>Ingresa las credenciales de tu proyecto Firebase. Puedes obtenerlas desde Firebase Console > Configuraci√≥n del proyecto > Tus aplicaciones.</p>
                    
                    <div class="form-group">
                        <label for="apiKey">API Key</label>
                        <input type="text" id="apiKey" placeholder="Ej: AIzaSyD...">
                    </div>
                    
                    <div class="form-group">
                        <label for="authDomain">Auth Domain</label>
                        <input type="text" id="authDomain" placeholder="Ej: mi-proyecto.firebaseapp.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="projectId">Project ID</label>
                        <input type="text" id="projectId" placeholder="Ej: mi-proyecto">
                    </div>
                    
                    <div class="form-group">
                        <label for="storageBucket">Storage Bucket</label>
                        <input type="text" id="storageBucket" placeholder="Ej: mi-proyecto.appspot.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="messagingSenderId">Messaging Sender ID</label>
                        <input type="text" id="messagingSenderId" placeholder="Ej: 123456789012">
                    </div>
                    
                    <div class="form-group">
                        <label for="appId">App ID</label>
                        <input type="text" id="appId" placeholder="Ej: 1:123456789012:web:abcd1234">
                    </div>
                </div>
                
                <!-- Paso 2: Configurar Reglas de Firestore -->
                <div id="rulesBlock" class="setup-block warning hidden">
                    <h2>‚ö†Ô∏è 2. Configurar Reglas de Firestore (OBLIGATORIO)</h2>
                    
                    <div class="alert alert-warning">
                        <strong>Error detectado:</strong> Las reglas de seguridad de Firebase est√°n bloqueando el acceso.
                    </div>
                    
                    <div class="instructions">
                        <p><strong>Sigue estos pasos para configurar las reglas:</strong></p>
                        <ol>
                            <li>Ve a la <a href="https://console.firebase.google.com/" target="_blank">Firebase Console</a></li>
                            <li>Selecciona tu proyecto: <strong id="projectIdDisplay"></strong></li>
                            <li>En el men√∫ izquierdo, haz clic en "Firestore Database"</li>
                            <li>Haz clic en la pesta√±a "Reglas"</li>
                            <li>Reemplaza TODO el c√≥digo con este:</li>
                        </ol>
                        
                        <div class="code-block">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
                        </div>
                        
                        <ol start="6">
                            <li>Haz clic en "Publicar"</li>
                            <li>Espera 30 segundos y haz clic en el bot√≥n de abajo</li>
                        </ol>
                        
                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è IMPORTANTE:</strong> Estas reglas son solo para la configuraci√≥n inicial. 
                            Despu√©s de completar el setup, debes cambiarlas por reglas seguras.
                        </div>
                    </div>
                    
                    <button id="retrySetupBtn" class="btn btn-warning">üîÑ Reintentar Configuraci√≥n</button>
                </div>
                
                <!-- Bot√≥n para continuar -->
                <button id="continueBtn" class="btn">üëâ Continuar con la Configuraci√≥n</button>
                
                <div class="logs-container">
                    <div id="logs">
                        <div class="log-item log-info">‚è≥ Esperando configuraci√≥n...</div>
                    </div>
                </div>
            </div>
            
            <!-- Reglas de seguridad finales -->
            <div id="finalRules" class="setup-block success hidden">
                <h2>üîí Configurar Reglas de Seguridad Finales</h2>
                <p>Ahora que el sistema est√° configurado, debes cambiar las reglas de Firestore por estas m√°s seguras:</p>
                
                <div class="code-block">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Permite acceso solo a usuarios autenticados
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
    
    // La configuraci√≥n del sistema es p√∫blica para verificar
    match /systemConfig/setup {
      allow read: if true;
      allow write: if false;
    }
  }
}
                </div>
                
                <div class="instructions">
                    <p><strong>Pasos:</strong></p>
                    <ol>
                        <li>Ve a Firebase Console > Firestore Database > Reglas</li>
                        <li>Reemplaza las reglas temporales con el c√≥digo de arriba</li>
                        <li>Haz clic en "Publicar"</li>
                        <li>¬°Listo! El sistema est√° completamente configurado y seguro</li>
                    </ol>
                </div>
                
                <div class="alert alert-success">
                    ‚úÖ Sistema configurado correctamente. Ahora puedes acceder a la aplicaci√≥n principal con:
                    <br><strong>Email:</strong> admin@pasteleria.com
                    <br><strong>Contrase√±a:</strong> admin123
                    <br><br>
                    <a href="app.html" class="btn" style="width: auto; display: inline-block;">üöÄ Ir a la Aplicaci√≥n</a>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Sistema de Gesti√≥n para Pasteler√≠a - Solo ejecutar esta configuraci√≥n una vez</p>
        </div>
    </div>

    <script>
        // Configuraci√≥n Firebase (se actualizar√° con los valores del formulario)
        const firebaseConfig = {
          apiKey: "AIzaSyCn-IxmpSh1PNg81zDCd8GUC7imM9XXAVA",
          authDomain: "dolcefranrecetas.firebaseapp.com",
          projectId: "dolcefranrecetas",
          storageBucket: "dolcefranrecetas.firebasestorage.app",
          messagingSenderId: "322101534324",
          appId: "1:322101534324:web:e95dee5189edd3309ffb21"
        };
        // Referencias globales
        let db;
        let auth;
        let setupCompleted = false;
        let retryCount = 0;
        const maxRetries = 3;
        
        // Elementos DOM
        const alreadyConfiguredEl = document.getElementById('alreadyConfigured');
        const setupFormEl = document.getElementById('setupForm');
        const continueBtn = document.getElementById('continueBtn');
        const retrySetupBtn = document.getElementById('retrySetupBtn');
        const rulesBlock = document.getElementById('rulesBlock');
        const finalRules = document.getElementById('finalRules');
        const logsEl = document.getElementById('logs');
        const steps = document.querySelectorAll('.step');
        const projectIdDisplay = document.getElementById('projectIdDisplay');
        
        // Verificar si el sistema ya est√° configurado
        async function checkIfConfigured() {
            try {
                // Intentar cargar la configuraci√≥n de localStorage
                const savedConfig = localStorage.getItem('pasteleriaProConfig');
                if (savedConfig) {
                    const config = JSON.parse(savedConfig);
                    
                    // Intentar inicializar Firebase con la configuraci√≥n guardada
                    firebase.initializeApp(config.firebaseConfig);
                    db = firebase.firestore();
                    
                    // Verificar si ya existe la colecci√≥n de configuraci√≥n
                    const configDoc = await db.collection('systemConfig').doc('setup').get();
                    
                    if (configDoc.exists && configDoc.data().setupCompleted) {
                        setupCompleted = true;
                        alreadyConfiguredEl.classList.remove('hidden');
                        setupFormEl.classList.add('hidden');
                        
                        // Actualizar pasos
                        steps[0].classList.add('completed');
                        steps[1].classList.add('completed');
                        steps[2].classList.add('completed');
                        steps[3].classList.add('completed', 'active');
                    } else {
                        // Usar la configuraci√≥n guardada en el formulario
                        document.getElementById('apiKey').value = config.firebaseConfig.apiKey;
                        document.getElementById('authDomain').value = config.firebaseConfig.authDomain;
                        document.getElementById('projectId').value = config.firebaseConfig.projectId;
                        document.getElementById('storageBucket').value = config.firebaseConfig.storageBucket;
                        document.getElementById('messagingSenderId').value = config.firebaseConfig.messagingSenderId;
                        document.getElementById('appId').value = config.firebaseConfig.appId;
                        
                        addLog("‚úÖ Configuraci√≥n encontrada en localStorage", "success");
                    }
                }
            } catch (error) {
                addLog("‚ÑπÔ∏è No se encontr√≥ configuraci√≥n previa. Proceder con nueva configuraci√≥n.", "info");
            }
        }
        
        // A√±adir mensaje a los logs
        function addLog(message, type = "info") {
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úÖ' : 
                        type === 'error' ? '‚ùå' : 
                        type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            logItem.textContent = `[${timestamp}] ${icon} ${message}`;
            logsEl.appendChild(logItem);
            logsEl.scrollTop = logsEl.scrollHeight;
        }
        
        // Mostrar paso de reglas de seguridad
        function showRulesStep() {
            const projectId = document.getElementById('projectId').value;
            if (!projectId) {
                alert("Por favor, ingresa el Project ID primero");
                return;
            }
            
            projectIdDisplay.textContent = projectId;
            rulesBlock.classList.remove('hidden');
            continueBtn.classList.add('hidden');
            
            // Actualizar pasos
            steps[0].classList.add('completed');
            steps[1].classList.add('active');
        }
        
        // Inicializar Firebase y base de datos
        async function initializeDatabase() {
            // Obtener valores del formulario
            firebaseConfig.apiKey = document.getElementById('apiKey').value.trim();
            firebaseConfig.authDomain = document.getElementById('authDomain').value.trim();
            firebaseConfig.projectId = document.getElementById('projectId').value.trim();
            firebaseConfig.storageBucket = document.getElementById('storageBucket').value.trim();
            firebaseConfig.messagingSenderId = document.getElementById('messagingSenderId').value.trim();
            firebaseConfig.appId = document.getElementById('appId').value.trim();
            
            // Validar que todos los campos est√©n completos
            for (const key in firebaseConfig) {
                if (!firebaseConfig[key]) {
                    addLog(`‚ùå Falta completar el campo: ${key}`, "error");
                    return false;
                }
            }
            
            // Deshabilitar bot√≥n mientras se ejecuta
            continueBtn.disabled = true;
            continueBtn.textContent = "‚è≥ Inicializando...";
            
            try {
                addLog("üîó Conectando con Firebase...", "info");
                
                // Inicializar Firebase
                firebase.initializeApp(firebaseConfig);
                
                // Obtener referencias a Firestore y Authentication
                db = firebase.firestore();
                auth = firebase.auth();
                
                // Configurar timeout para Firestore
                db.settings({
                    ignoreUndefinedProperties: true
                });
                
                // Actualizar pasos
                steps[0].classList.add('completed');
                steps[1].classList.add('completed');
                steps[2].classList.add('active');
                
                addLog("‚úÖ Firebase inicializado correctamente", "success");
                
                // Crear colecciones y documentos
                const collectionsCreated = await createCollections();
                if (!collectionsCreated) {
                    showRulesStep();
                    return false;
                }
                
                // Crear usuario admin inicial
                const adminCreated = await createAdminUser();
                if (!adminCreated) {
                    showRulesStep();
                    return false;
                }
                
                // Insertar datos de ejemplo
                await insertSampleData();
                
                // Marcar configuraci√≥n como completada
                await db.collection('systemConfig').doc('setup').set({
                    setupCompleted: true,
                    configuredAt: firebase.firestore.FieldValue.serverTimestamp(),
                    version: "1.0.0",
                    adminEmail: 'admin@pasteleria.com'
                });
                
                // Guardar configuraci√≥n en localStorage para uso futuro
                localStorage.setItem('pasteleriaProConfig', JSON.stringify({
                    firebaseConfig,
                    configuredAt: new Date().toISOString()
                }));
                
                // Actualizar pasos
                steps[2].classList.add('completed');
                steps[3].classList.add('completed', 'active');
                
                addLog("‚úÖ Configuraci√≥n completada exitosamente!", "success");
                addLog("üéâ Sistema listo para usar. Ahora puedes acceder a la aplicaci√≥n principal.", "info");
                
                // Mostrar credenciales de admin
                addLog("üìã Credenciales de administrador: admin@pasteleria.com / admin123", "info");
                addLog("‚ö†Ô∏è IMPORTANTE: Cambia estas credenciales despu√©s del primer inicio de sesi√≥n", "warning");
                
                // Ocultar formulario y mostrar reglas finales
                setupFormEl.classList.add('hidden');
                finalRules.classList.remove('hidden');
                
                return true;
                
            } catch (error) {
                addLog(`‚ùå Error: ${error.message}`, "error");
                
                // Verificar si es error de permisos
                if (error.message.includes('Missing or insufficient permissions') || 
                    error.message.includes('PERMISSION_DENIED')) {
                    
                    if (retryCount < maxRetries) {
                        retryCount++;
                        addLog(`üîÑ Reintentando... (Intento ${retryCount}/${maxRetries})`, "warning");
                        setTimeout(initializeDatabase, 2000);
                    } else {
                        showRulesStep();
                    }
                } else {
                    continueBtn.disabled = false;
                    continueBtn.textContent = "üëâ Continuar con la Configuraci√≥n";
                }
                
                return false;
            }
        }
        
        // Crear las colecciones necesarias
        async function createCollections() {
            const collections = [
                'systemConfig',
                'users',
                'ingredients',
                'recipes',
                'productions',
                'stockMovements',
                'shoppingList'
            ];
            
            try {
                // Primero, verificar si podemos escribir en Firestore
                const testDoc = db.collection('systemConfig').doc('test');
                await testDoc.set({
                    test: true,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                await testDoc.delete();
                
                addLog("‚úÖ Permisos de Firestore verificados", "success");
                
                for (const collectionName of collections) {
                    // Crear un documento temporal para asegurar que la colecci√≥n existe
                    const tempDoc = db.collection(collectionName).doc('_temp');
                    await tempDoc.set({
                        created: firebase.firestore.FieldValue.serverTimestamp(),
                        test: true
                    });
                    
                    // Eliminar el documento temporal
                    await tempDoc.delete();
                    
                    addLog(`‚úÖ Colecci√≥n '${collectionName}' creada`, "success");
                }
                return true;
            } catch (error) {
                addLog(`‚ùå Error creando colecciones: ${error.message}`, "error");
                return false;
            }
        }
        
        // Crear usuario administrador inicial
        async function createAdminUser() {
            try {
                // Primero, verificar si el usuario ya existe
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(
                        'admin@pasteleria.com',
                        'admin123'
                    );
                    
                    addLog("‚úÖ Usuario administrador ya existe", "success");
                    return true;
                } catch (signInError) {
                    // Si no existe, crearlo
                    if (signInError.code === 'auth/user-not-found') {
                        const userCredential = await auth.createUserWithEmailAndPassword(
                            'admin@pasteleria.com',
                            'admin123'
                        );
                        
                        // Guardar informaci√≥n adicional en Firestore
                        await db.collection('users').doc(userCredential.user.uid).set({
                            email: 'admin@pasteleria.com',
                            name: 'Administrador',
                            role: 'admin',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        addLog("‚úÖ Usuario administrador creado: admin@pasteleria.com", "success");
                        return true;
                    } else {
                        throw signInError;
                    }
                }
            } catch (error) {
                addLog(`‚ùå Error con usuario admin: ${error.message}`, "error");
                return false;
            }
        }
        
        // Insertar datos de ejemplo
        async function insertSampleData() {
            try {
                // 1. Insertar 2 insumos de ejemplo
                const ingredients = [
                    {
                        name: "Harina de Trigo",
                        unit: "kg",
                        currentStock: 10,
                        minStock: 5,
                        unitCost: 2.5,
                        costUnit: "kg",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Az√∫car Blanca",
                        unit: "kg",
                        currentStock: 3,  // Stock bajo para ejemplo
                        minStock: 5,
                        unitCost: 1.8,
                        costUnit: "kg",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Huevos",
                        unit: "u",
                        currentStock: 24,
                        minStock: 12,
                        unitCost: 0.25,
                        costUnit: "u",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Mantequilla",
                        unit: "kg",
                        currentStock: 2,
                        minStock: 1,
                        unitCost: 4.5,
                        costUnit: "kg",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }
                ];
                
                for (const ingredient of ingredients) {
                    await db.collection('ingredients').add(ingredient);
                    addLog(`‚úÖ Insumo creado: ${ingredient.name}`, "success");
                }
                
                // 2. Insertar recetas de ejemplo
                // Primero necesitamos obtener el ID de los insumos reci√©n creados
                const ingredientsSnapshot = await db.collection('ingredients').get();
                const ingredientMap = {};
                ingredientsSnapshot.forEach(doc => {
                    const data = doc.data();
                    ingredientMap[data.name] = doc.id;
                });
                
                const recipes = [
                    {
                        name: "Pastel de Chocolate B√°sico",
                        description: "Pastel de chocolate esponjoso con cobertura",
                        portions: 8,
                        ingredients: [
                            {
                                ingredientId: ingredientMap["Harina de Trigo"],
                                name: "Harina de Trigo",
                                quantity: 0.5,
                                unit: "kg"
                            },
                            {
                                ingredientId: ingredientMap["Az√∫car Blanca"],
                                name: "Az√∫car Blanca",
                                quantity: 0.3,
                                unit: "kg"
                            },
                            {
                                ingredientId: ingredientMap["Huevos"],
                                name: "Huevos",
                                quantity: 4,
                                unit: "u"
                            },
                            {
                                ingredientId: ingredientMap["Mantequilla"],
                                name: "Mantequilla",
                                quantity: 0.25,
                                unit: "kg"
                            }
                        ],
                        instructions: "1. Precalentar horno a 180¬∞C\n2. Mezclar todos los ingredientes secos\n3. Batir los huevos y agregar la mantequilla derretida\n4. Combinar todo y hornear por 40 minutos",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    },
                    {
                        name: "Galletas de Mantequilla",
                        description: "Galletas crujientes de mantequilla",
                        portions: 24,
                        ingredients: [
                            {
                                ingredientId: ingredientMap["Harina de Trigo"],
                                name: "Harina de Trigo",
                                quantity: 0.4,
                                unit: "kg"
                            },
                            {
                                ingredientId: ingredientMap["Mantequilla"],
                                name: "Mantequilla",
                                quantity: 0.2,
                                unit: "kg"
                            }
                        ],
                        instructions: "1. Mezclar la mantequilla con la harina\n2. Formar bolitas y hornear a 170¬∞C por 15 minutos",
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    }
                ];
                
                for (const recipe of recipes) {
                    await db.collection('recipes').add(recipe);
                    addLog(`‚úÖ Receta creada: ${recipe.name}`, "success");
                }
                
                addLog("‚úÖ Datos de ejemplo insertados correctamente", "success");
                return true;
            } catch (error) {
                addLog(`‚ö†Ô∏è Error insertando datos de ejemplo: ${error.message}`, "warning");
                return false;
            }
        }
        
        // Inicializar la verificaci√≥n al cargar la p√°gina
        window.addEventListener('DOMContentLoaded', () => {
            checkIfConfigured();
            
            // Configurar el bot√≥n de continuar
            continueBtn.addEventListener('click', () => {
                initializeDatabase();
            });
            
            // Configurar el bot√≥n de reintentar
            retrySetupBtn.addEventListener('click', () => {
                rulesBlock.classList.add('hidden');
                continueBtn.classList.remove('hidden');
                continueBtn.disabled = false;
                continueBtn.textContent = "üëâ Continuar con la Configuraci√≥n";
                addLog("üîÑ Reintentando configuraci√≥n...", "info");
                initializeDatabase();
            });
        });
    </script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</body>
</html>
